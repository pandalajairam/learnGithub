!function(a){"use strict";var b=a.App={};b.IS_DEV=0===location.hostname.indexOf("local"),b.Pages={},b.Components={},b.Events=$({}),b.Services={findByGeo:"/ESB/FindFacilitiesByGeo"},b.Events.on("loaded",function(){var c=Backbone.Router.extend({_routeToRegExp:function(a){return a+="(/)",a=Backbone.Router.prototype._routeToRegExp.call(this,a),new RegExp(a.source,"i")},routes:{"":b.Pages.Home.init,"Join/Step1":b.Pages.Join.SelectClub.init,"Join/Step3":b.Pages.Join.MembershipPurchase.init,"Join/:facilityId":b.Pages.Join.SelectMembership.init,Login:b.Pages.Login.init,"Help/ForgotPassword":b.Pages.Password.Forgot.init,"Help/Recover-Password/:token":b.Pages.Password.Reset.init,"Help/Change/UserName":b.Pages.User.ChangeUserName.init,"help/upgrade/spa-member":b.Pages.User.SpaMemberUpgrade.init,"Help/forgotUser":b.Pages.User.Forgot.init,"login/connect":b.Pages.ConnnectAccounts.init,bookabike:b.Pages.Mock.Book.init,"bookabike/detail":b.Pages.Mock.Book.init,"Activate/start":b.Pages.Activate.init,"activate/email/:guid":b.Pages.OnBoarding.start,"Activate/verifyemail/:token":b.Pages.User.VerifyUserName.init,"activate/signin":b.Pages.SignIn.init,"activate/signin/facebook/email":b.Pages.SignIn.FacebookWithOutEmail.init,"activate/signin/equinox":b.Pages.CreateAccount.init,Clubs:b.Pages.Clubs.init,"modules/clubslanding":b.Pages.Clubs.init,"Regions/:region":b.Pages.Clubs.init,"Clubs/:club":b.Pages.Facilities.init,"Clubs/:region/:club":b.Pages.Facilities.init,"Clubs/:region/:subregion/:club":b.Pages.Facilities.init,"questionnaire/:step":b.Pages.OnBoarding.init,groupfitness:b.Pages.GroupFitness.init,"groupfitness/:id":b.Pages.ClassDetail.init,notifications:b.Pages.Notifications.init,rewards:b.Pages.Rewards.init,"personal-training/schedule-equifit":b.Pages.ScheduleEquifit.init}});if(b.Router=new c,Backbone.history.start({hashChange:!1,pushState:!0}),$.ajaxSetup({cache:!1}),isDebugging){var d=function(){return this};a.Crittercism={logHandledException:d,leaveBreadcrumb:d,setUsername:d,setValue:d}}else console.log=function(){},Crittercism.init({appId:"525628e8a7928a3b36000003",appVersion:assemblyVersion+" "+assemblyServer});b.loadComponent("page-scroll"),$(document).ajaxError(function(a,b){null!==user&&401===b.status&&(location.href="/login?ReturnUrl="+window.location.pathname)}),null===user&&EQ.Helpers.user.invalidateFavoritesCache(),ZeroClipboard.config({swfPath:"/assets/ZeroClipboard.swf",moviePath:"/assets/ZeroClipboard.swf",zIndex:800,forceHandCursor:!0}),$("input, textarea").placeholder()})}(window),function(a,b){"use strict";var c=window.EQ.Helpers||{},d=b.Pages.Activate={},e=$(".activate-user");d.init=function(){debug("[Activate] Init"),d.setCookie(),d.bind()},d.setCookie=function(){"true"===c.getQueryStringVariable("fromios")&&(debug("[Activate] Cookie"),c.createCookie("from_ios",!0))},d.bind=function(){var a=d;e.on("submit",function(b){b.preventDefault(),a.validateAndSubmit()})},d.validateAndSubmit=function(){e.data("publicMethods").isValid()&&e.data("publicMethods").sendAjaxRequest({country:"ActivateUser.Country",barcode:"ActivateUser.Barcode",lastName:"ActivateUser.LastName"},function(a){var b=$("<form></form>");b.attr("action","/activate/signin").attr("method","POST");var c=$('<input type="hidden"/>').attr("name","FirstName").val(a.firstName),d=$('<input type="hidden"/>').attr("name","Email").val(a.emailAddress),f=$('<input type="hidden"/>').attr("name","LastName").val(e.find('input[name="ActivateUser.LastName"]').val()),g=$('<input type="hidden"/>').attr("name","Country").val(e.find('select[name="ActivateUser.Country"]').val()),h=$('<input type="hidden"/>').attr("name","Barcode").val(e.find('input[name="ActivateUser.Barcode"]').val());b.append(f),b.append(c),b.append(g),b.append(d),b.append(h),b.css("display","none"),$("body").append(b),b.submit()})}}(window,window.App),function(a){"use strict";var b=a.Pages.ClassDetail={},c=Backbone.Model.extend({defaults:{id:"",type:"",selected:!1,displayName:""}}),d=Backbone.Collection.extend(),e=Backbone.View.extend({el:".favorites-class-container",initialize:function(a){this.options=a||{}},render:function(){var a=new d,b=new f,c=new g({collection:a,favoritesData:this.options.favoritesData,updateCallback:b.updateCount.bind(b)});b.render(),c.render()}}),f=Backbone.View.extend({el:".favorites-button",updateCount:function(a){var b="";0!==a&&(b="("+a+")"),this.$el.find(".favorite-count").text(b)},render:function(){var a=this;this.$el.on("click",function(){a.$el.toggleClass("active")})}}),g=Backbone.View.extend({el:".favorites-list",initialize:function(a){this.options=a||{}},updateCount:function(){var a=0;this.collection.each(function(b){b.get("selected")&&a++}),this.options.updateCallback(a)},render:function(){var a=this;this.$el.find("li").each(function(b,d){var e,f,g=$(d).attr("data-type"),i=parseInt($(d).attr("data-id"),10),j=a.options.favoritesData,k=!1;-1!==_.findIndex(j[g],{id:i})&&(k=!0),e=new c({displayName:$(d).find("strong").text(),type:g,id:i,selected:k}),a.collection.add(e),f=new h({el:d,model:e,updateCallback:a.updateCount.bind(a)}),f.render()})}}),h=Backbone.View.extend({model:c,initialize:function(a){this.options=a||{}},toggleSelected:function(){this.model.set("selected",!this.model.get("selected")),this.options.updateCallback(),this.$el.find("span").toggleClass("icon-star icon-star-empty")},updateFavorite:function(){var a=this.model.get("selected"),b=APIEndpoint+"/me/favorites/"+this.model.get("type"),c=this;a?(b=b+"/remove/"+this.model.get("id"),$.ajax({type:"DELETE",url:b,xhrFields:{withCredentials:!0},contentType:"application/json"}).success(function(a){debug("DESTROY MODEL",a),c.toggleSelected()})):(this.model.urlRoot=b,this.model.save({},{contentType:"application/json",xhrFields:{withCredentials:!0},success:function(a,b){debug("SAVE MODEL",b),c.toggleSelected()}})),EQ.Helpers.user.invalidateFavoritesCache()},render:function(){var a=this;this.model.get("selected")&&(this.$el.find("span").removeClass("icon-star-empty").addClass("icon-star"),this.options.updateCallback()),this.$el.on("click",function(){a.updateFavorite()})}}),i={},j={},k={},l={};i.init=function(a,b){$.ajax({type:"GET",url:a,contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",success:function(a){debug("bikesdata",a),null!==a.reservation.result?($(".see-bike, .cancel-class").addClass("active"),$(".cancel-class").on("click",function(){i.cancelBike(b,$(this))})):($(".see-bike, .cancel-class").removeClass("active"),$(".book-bike, .remove-class").addClass("active")),a.classInstanceDetail.isFinished===!0&&$(".see-bike, .book-bike").removeClass("active")},error:function(a){debug("server error",a.responseJSON)}})},i.cancelBike=function(a,b){console.log("CANCEL BIKE");var c,d=APIEndpoint+"/classes/bikes/"+a+"/cancel";c=EQ.Helpers.loaderAndErrorHandler(b,{type:"button",color:"black",errorTitle:"Error"}),c.showLoader(),$.ajax({type:"DELETE",url:d,contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",success:function(a){debug("CANCEL BIKE OK",a),c.hideLoader(),$(".see-bike, .cancel-class").removeClass("active"),$(".remove-class, .book-bike").addClass("active")},error:function(a){debug("server error",a.responseJSON),c.showError()}})},j.init=function(a){$.ajax({type:"GET",url:a,contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",success:function(a){debug("classdata",a),window.tagData=window.tagData||{};var b=window.moment(a.startLocal).diff(a.facilityCurrentDateTime,"hours"),c=window.moment(a.startLocal).diff(a.facilityCurrentDateTime,"minutes");if(b=b>0?Math.floor(b):Math.ceil(b),0===b&&(b=c>0?1:-1),window.tagData.classInstance={classId:a.classId.toString(),facilityId:a.facility.facilityId,classInstanceId:a.classInstanceId.toString(),categoryId:a.primaryCategory.categoryId.toString(),timeOffset:b.toString()},j.jsonData=a,a.isOnCalendar===!1)$(".add-class").addClass("active");else if($(".export-to-calendar").addClass("active"),a.isCyclingClass===!0){var d=APIEndpoint+"/classes/bikes/"+k.classInstance;i.init(d,k.classInstance)}else $(".remove-class").addClass("active");$(".add-class").on("click",j.addClass),$(".remove-class").on("click",j.removeClass)},error:function(a){debug("server error",a.responseJSON)}})},j.addClass=function(a){a.preventDefault();var b,c=APIEndpoint+"/me/calendar/"+k.classInstance+"?isRecurring=false";b=EQ.Helpers.loaderAndErrorHandler($(this),{type:"button",color:"white",errorTitle:"Error"}),b.showLoader(),$.ajax({type:"POST",url:c,contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",success:function(a){debug("[ADDCLASS OK]",a),b.hideLoader(),j.jsonData.userEventId=a.result.id,j.jsonData.isCyclingClass===!0?($(".bike-overlay.add, .remove-class, .book-bike, .export-to-calendar").addClass("active"),$(".add-class").removeClass("active"),setTimeout(function(){$(".bike-overlay.add").removeClass("active")},5e3)):($(".overlay-box.add, .export-to-calendar, .remove-class").addClass("active"),$(".add-class").removeClass("active"),setTimeout(function(){$(".overlay-box.add").removeClass("active")},5e3))},error:function(a){debug("server error",a.responseJSON),b.showError()}})},j.removeClass=function(a){a.preventDefault();var b,c=APIEndpoint+"/me/calendar/cancel/"+j.jsonData.userEventId+"?removeRecurring=false";b=EQ.Helpers.loaderAndErrorHandler($(this),{type:"button",color:"black",errorTitle:"Error"}),b.showLoader(),$.ajax({type:"DELETE",url:c,contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",success:function(a){debug("[REMOVECLASS OK]",a),b.hideLoader(),$(".overlay-box.remove, .add-class").addClass("active"),$(".remove-class, .see-bike, .book-bike, .export-to-calendar").removeClass("active"),setTimeout(function(){$(".overlay-box.remove").removeClass("active")},5e3)},error:function(a){debug("server error",a.responseJSON),b.showError()}})},b.renderButtons=function(){k.classInstance=$("nav.buttons").data("id"),l.classInstance=k.classInstance;var a=APIEndpoint+"/classes/"+l.classInstance;j.init(a)},b.updateOmniture=function(){if($(document).find($("#classDetailsInfo"))){window.tagData=window.tagData||{};var a=JSON.parse($("#classDetailsInfo").attr("data-component-options")),b=window.moment(a.startLocal).diff(a.facilityCurrenttime,"hours"),c=window.moment(a.startLocal).diff(a.facilityCurrenttime,"minutes");b&&(b=b>0?Math.floor(b):Math.ceil(b),0===b&&(b=c>0?1:-1)),window.tagData.classInstance={classId:a.classID,facilityId:a.facilityID,classInstanceId:a.classInstanceID,categoryId:a.categoryID,timeOffset:b.toString()}}},b.init=function(a){console.log(a),EQ.Helpers.user.getFavorites(function(a){var b=new e({favoritesData:a});b.render()}),b.renderButtons(),b.updateOmniture(),$("nav.main").hasClass("logged-out")&&$(".class-module").find("a.underlined-small-link.black:first").hide()}}(window.App),function(a){"use strict";var b=App.Pages.Facilities={};b.Icon=function(a){return'<div class="custom-marker active"><span class="icon-marker-o"></span><h5>'+a.ClubName+"</h5></div>"},b.setClub=function(a){var c=this.clubsMap.getFacilityById(a),d=this.clubsMap.Map,e=d.markers.find(c.Latitude,c.Longitude);d.fit([c],-3).freeze(),$(".native-map-trigger").attr("href",EQ.Helpers.getDeviceMapURL(c)),e&&(debug("[ClubDetail] Setting marker open:",e),e.setAnchor(RichMarkerPosition.TOP),e.setContent(b.Icon(c)))},b.init=function(c,d,e){debug("[ClubDetail] init:",e),a.isClubDetail=!0,2===arguments.length?(e=d,d=null):1===arguments.length&&(e=c,d=null,c=null),EQ.Maps.on("IDLE_LOAD",function(){b.clubsMap=$(".map-container").data("clubsMap"),b.setClub(currentClub)})}}(window),function(a,b){"use strict";var c=b.Pages.Clubs={};c.Region={showAll:function(){var a=this;c.Map.markers.empty(),$.each(c.Data,function(b,d){d.bounds||(d.bounds=EQ.Maps.Bounds(c.getChildrenPoints(d))),a.addMarker(d)}),EQ.Maps.once("IDLE",c.updateLabelPosition)},addMarker:function(a){c.Map.markers.add({lat:a.bounds.getCenter().lat(),lng:a.bounds.getCenter().lng(),content:c.Icon.Region(a),click:function(b){b.stopPropagation(),c.Region.select(a)}},!0)},showClubs:function(a){debug("[Clubs] Showing clubs markers"),EQ.Maps.once("BOUNDS_CHANGE",function(a){debug("[Clubs] Setting markerThreshold:",a.map.getZoom()),c.markerThreshold=a.map.getZoom()}),c.Map.fitBounds(a.bounds),c.Club.showAll()},showSubs:function(a){debug("[Clubs] Region level (showing Subregion labels)"),"New York"===a.Name&&a.bounds.extend(EQ.Maps.Point({lat:40.45,lng:-74.15})),c.Map.fitBounds(a.bounds),c.Subregion.showAll()},select:function(a){var b=this;a.bounds||(a.bounds=EQ.Maps.Bounds(c.getChildrenPoints(a))),$.each(a,function(a,b){if("string"==typeof b){var c=$('[data-region-text="'+a.toLowerCase()+'"]');c.length&&c.html(b)}}),c.isRegionLanding||$(".region-information .description").load("/regions/"+a.ShortName+" .paragraph p"),a.SubRegions&&a.SubRegions.length?(debug("[Clubs] It has subregions"),EQ.Geo.getNearestClub(function(d){var e;debug("[Clubs] Nearest club is:",d),d&&d.Region===a.Title&&$.each(a.SubRegions,function(a,b){$.each(b.Facilities,function(a,c){c.Id===d.Id&&(e=b)})}),e&&!c.isRegionLanding?(debug("[Clubs] Chosen subregion is:",e.Title),e.bounds=EQ.Maps.Bounds(c.getChildrenPoints(e)),b.showClubs(e)):b.showSubs(a)})):b.showClubs(a)}},c.Subregion={showAll:function(){var a=this;c.Map.markers.empty(),$.each(c.Data,function(b,d){d.bounds||(d.bounds=EQ.Maps.Bounds(c.getChildrenPoints(d))),d.SubRegions&&d.SubRegions.length?$.each(d.SubRegions,function(b,d){d.bounds||(d.bounds=EQ.Maps.Bounds(c.getChildrenPoints(d))),a.addMarker(d)}):c.Region.addMarker(d)}),EQ.Maps.once("IDLE",c.updateLabelPosition)},addMarker:function(a){c.Map.markers.add({lat:a.bounds.getCenter().lat(),lng:a.bounds.getCenter().lng(),content:c.Icon.Subregion(a),click:function(b){b.stopPropagation(),c.Map.fitBounds(a.bounds),c.Club.showAll()}},!0)}},c.Club={parse:function(a){return EQ.Helpers.setPositionGetter(a),c.Map.markers.add({lat:a.Latitude,lng:a.Longitude,content:c.Icon.Marker.regular(),click:function(b){b.stopPropagation(),EQ.Maps.trigger("CLUB_MARKER_CLICK",{facility:a,marker:this})}},!0),this},getLink:function(a){return a.URL||"/Clubs/"+a.ShortName},show:function(a){if(c.lastClubShow)return!1;if(c.lastClubShow=!0,setTimeout(function(){c.lastClubShow=!1},1e3),a.marker.getContent().indexOf("active")>-1)return c.Club.hide();var b=a.marker.getPosition(),d=c.Club.getLink(a.facility);if(c.Map.map.panTo(b),c.Map.markers.setIcon(c.Icon.Marker.regular()),c.$el.find(".icon-marker-dot").addClass("darker"),a.marker.setContent(c.Icon.Marker.active(a.facility)),c.$info&&(c.$info.find('[data-club-href="url"]').attr("href",d),c.$info.find('[data-club-text="telephone"]').attr("href","tel:"+a.facility.Telephone.replace(/\./g,"-")),$.each(a.facility,function(a,b){if("string"==typeof b){var c=$('[data-club-text="'+a.toLowerCase()+'"]');c.length&&c.html(b)}})),$("div.club-information").removeClass("hidden"),"small"===EQ.Helpers.getDeviceSize()){var e=c.$el.offset().top-$("nav.main").height();$("html, body").animate({scrollTop:e},300)}return this},hide:function(){"Club"===c.layout&&(c.Map.markers.setIcon(c.Icon.Marker.regular()),c.$el.find(".icon-marker-dot").removeClass("darker"))},showAll:function(){if(c.layout="Club",c.preventZoomChange=!0,c.Map.markers.empty(),!this._facilities){var a=[];$.each(c.Data,function(b,c){a=a.concat(EQ.Helpers.getAllFacilities(c))}),this._facilities=a}$.each(this._facilities,function(a,b){c.Club.parse(b)})}},c.Icon={Marker:{regular:function(){return'<div class="custom-marker"><span class="icon-marker-dot"></span></div>'},active:function(a){return'<div class="custom-marker active"><span class="icon-marker-o"></span><h5>'+a.ClubName+'</h5><div class="is-tablet is-desktop"><address>'+a.GoogleAddress+'</address><a href="'+c.Club.getLink(a)+'" class="button white fat cta">More Info</a></div></div>'}},Subregion:function(a){var b=a.Facilities.length;return'<div class="custom-marker caption"><span>'+a.Name+"</span><small>"+b+" Club"+(1===b?"":"s")+"</small></div>"},Region:function(a){var b=a.Facilities.length;return $.each(a.SubRegions,function(a,c){b+=c.Facilities.length}),'<div class="custom-marker caption"><span>'+a.Name+"</span><small>"+b+" Club"+(1===b?"":"s")+"</small></div>"}},c.getChildrenPoints=function(a){var b=this,c=[];return a.SubRegions&&a.SubRegions.length?$.each(a.SubRegions,function(a,d){c=c.concat(b.getChildrenPoints(d))}):a.Facilities.length&&(c=$.map(a.Facilities,function(a){return a.Latitude&&a.Longitude?EQ.Maps.Point({lat:a.Latitude,lng:a.Longitude}):void console.error("A club doesn't have Lat Lng properties.",a)})),c},c.updateLabelPosition=function(){debug("[Clubs] updatePosition length:",$(".custom-marker.caption").length);var a,b,c=[];if($(".custom-marker.caption").each(function(){var a=$(this),b=a.offset();c.push({y:b.top,height:a.height()>>0,x:b.left,width:a.width()>>0,el:a.offsetParent()})}),c.length){c.sort(function(a,b){return a.y-b.y}),b=c[0].y-1,a=c[0].el.offsetParent().offset().top;for(var d=0,e=c.length;e>d;d++){var f=c[d];if(f.y>b)b=f.y+f.height;else{var g=c[d-1];f.x>g.x+g.width?debug("[Clubs] Should not collide:",f.el,g.el):(f.el.css("top",b-a),b+=f.height)}}}},c.hasToChangeLayout=function(a){var b=null,d=c.subregionThreshold||9,e=c.markerThreshold||13;return b=d>a?"Region":e>a?"Subregion":"Club",b!==c.layout?(c.layout=b,!0):!1},c.onMapsLoaded=function(){$(".club-finder").addClass("visible"),c.$el=$(".map-container");var a="small"===EQ.Helpers.getDeviceSize()?7:10;if(c.Map=new EQ.Maps.Map(c.$el[0],41.850033,-87.6500523,{zoom:a,minZoom:a}),c.Map.mobilePanning(),EQ.Maps.on("CLUB_MARKER_CLICK",c.Club.show),EQ.Maps.on("MAP_CLICK",function(){c.lastClubShow||c.Club.hide()}),EQ.Maps.on("ZOOM_CHANGE",function(a){return c.preventZoomChange?(c.preventZoomChange=!1,!1):void(c.hasToChangeLayout(a.zoom)?c[c.layout].showAll():"Club"===c.layout?c.Club.hide():c.updateLabelPosition())}),c.isRegionLanding){var b=EQ.Helpers.getRegionByTitle($(".clubs-region").data("region"));b&&(c.preventZoomChange=!0,c.Region.select(b))}else EQ.Geo.getNearestRegion(function(a){a&&(c.preventZoomChange=!0,c.Region.select(a))})},c.Data=a.allRegionsData,c.setupTabs=function(){$(".tabs-simple").simpleTabs({onTabShown:function(){setTimeout(function(){console.warn("load near clubs map"),EQ.Maps.fixLayout()},600)}})},c.hideOfflineMsg=function(){c.$views.$geoOffline.hide()},c.setDefaultMap=function(){if(!c.userLocationKnown){c.$el=$(".map-container");var a=3;c.Map=new EQ.Maps.Map(c.$el[0],41.850033,-87.6500523,{zoom:a,minZoom:a}),c.Club.showAll()}},c.setTemporaryInfo=function(){c.setDefaultMap()},c.bindings=function(){c.$views.$geoOffline.find("a").on("click",function(a){a.preventDefault(),$(this).closest(".geo-offline").hide()})},c.$views={$geoOffline:$(".geo-offline")},c.userLocationKnown=!1,c.init=function(a){c.isRegionLanding=!!a,c.$finder=$(".club-finder"),c.$info=$("div.club-information"),c.bindings(),c.setupTabs(),EQ.Maps.on("CLUB_SET_CENTER",function(a){c.Map.map.setCenter({lat:a.lat,lng:a.lng}),c.Map.map.minZoom=3,c.Map.unfreeze(),c.Map.markers={map:{},markers:[]},setTimeout(function(){c.Map.map.setZoom(1)},1e3)}),EQ.Geo.getLatLng(function(){debug("[Clubs Finder] ALLOWED TO USE GEO API"),c.hideOfflineMsg(),c.userLocationKnown=!0,EQ.Maps.Load(c.onMapsLoaded)},function(){debug("[Clubs Finder] NOT ALLOWED TO USE GEO API"),c.isRegionLanding?EQ.Maps.Load(c.onMapsLoaded):($(".region-information").hide(),c.$finder.removeClass("module").find(".region-list-container").removeClass("module"))});var b=$(".switch-views nav a");b.on("click",function(){b.removeClass("active").filter(this).addClass("active"),c.$finder.toggleClass("listing")})}}(window,window.App),function(a,b){"use strict";var c=b.Pages.ConnnectAccounts={},d=$("form.login");c.validateAndSubmit=function(){d.data("publicMethods").isValid()&&b.Pages.ConnnectAccounts.getToken(function(b){d.data("publicMethods").sendAjaxRequest({username:"email",password:"password",persistLogin:!0},function(c,d,e){if(202===e.status){if("LegacyUser"===c.code)return void $(".is-error").removeClass("hidden").html(c.reasonPhrase.replace("{username}",'<a href="javascript:void(0);" id="changeUsername" data-userName='+c.userName+" data-email="+c.email+">username</a>"));if("SpaOnlyUser"===c.code)return void $(".is-error").removeClass("hidden").html(c.reasonPhrase.replace("{signin}",'<a href="/login">sign in</a>'))}var f={facebookAccessToken:b};$.ajax(APIEndpoint+"/registration/linkwithfacebook",{data:JSON.stringify(f),contentType:"application/json",type:"POST",xhrFields:{withCredentials:!0}}).done(function(){"function"==typeof window.track&&window.track("regConnectedWithFB"),debug("[Connect] Ready"),EQ.Helpers.refreshUserCacheData({async:!1});var b=window.returnUrl||"/";a.location.href=b}).fail(function(a){var b=a.responseJSON&&a.responseJSON.message;debug("[FBLogin] Failed",b),b&&$(".is-error").removeClass("hidden").text(b)})})})},c.getToken=function(a){FB.login(function(b){"connected"===b.status&&a(b.authResponse.accessToken)},{scope:"email,user_likes,user_friends"})},c.init=function(){debug("[Connect] Init"),d.on("submit",function(a){a.preventDefault(),c.validateAndSubmit()}),d.on("click","#changeUsername",function(a){a.preventDefault(),c.ChangeLegacyUserName($(this).data())})},c.ChangeLegacyUserName=function(a){var b=$("<form />");b.attr("action","/help/change/username").attr("method","POST");var c=$('<input type="hidden"/>').attr("name","email").val(a.email),d=$('<input type="hidden"/>').attr("name","userName").val(a.userName);b.append(c),b.append(d),$("body").append(b),b.submit()}}(window,window.App),function(a,b){"use strict";var c=b.Pages.CreateAccount={},d=$(".create-account");c.init=function(){debug("[CreateAccount] Init"),c.bind()},c.bind=function(){var a=c;d.on("submit",function(b){b.preventDefault(),a.validateAndSubmit()})},c.validateAndSubmit=function(){d.data("publicMethods").isValid()&&(d.data("publicMethods").sendAjaxRequest({email:"Create.Email",password:"Create.Password",sourceSystem:"Create.Country",lastName:"Create.LastName",firstName:"Create.FirstName",barcodeId:"Create.BarcodeId"},function(){console.log(d.find('input[name="Create.Email"]').val());var a={email:d.find('input[name="Create.Email"]').val()};debug("[CreateAccount] Callback"),$(".user-recover-confirmation").removeClass("hidden");var b=$(".confirmation-message-module");b.data("templateData",a),b.data("publicMethods").render(),window.track("regSignupVerifEmlSent"),d.add(".tpl-subtitleparagraphcallout.dtm-user-subtitleparagraphcallout").add(".create-acount-mail-sent").addClass("hidden"),$("body, html").animate({scrollTop:0})}),window.tagData=window.tagData||{},window.tagData.registration={success:"true",type:"eq"},window.track("registration",window.tagData.registration))}}(window,window.App),function(a,b){"use strict";b.Pages.GroupFitness={};var c=b.Pages.GroupFitness;c.init=function(){$(window).on("resize scroll",c.expandQuilt),c.expandQuilt()},c.expandImage=function(a){a.preventDefault(),$('.grid-active [class*="image-"]').remove(),$(this).find(".quilt-overlay").clone().fadeIn().appendTo(".grid-active").addClass("active"),$(".grid-active").fadeIn().addClass("active"),$(".groupfitness").addClass("overlay"),setTimeout(function(){$(".grid-active .quilt-overlay").addClass("overlay"),$("body").css({overflow:"hidden"})},100),$(".grid-active .close").on("click",function(a){a.preventDefault(),$(".grid-active .quilt-overlay").removeClass("overlay"),$("body").removeAttr("style"),$(".groupfitness").removeClass("overlay"),$(".grid-active").fadeOut().removeClass("active"),setTimeout(function(){$(".grid-active .quilt-overlay.active").remove()},700)})},c.expandQuilt=function(){var a=$('[class*="image-"]');a.off("click").on("click",c.expandImage)}}(window,window.App),function(a,b){"use strict";var c=b.Pages.Home={},d=$("body"),e=$(a);c.fitElement={currentTop:0,currentPage:0,hideTimeout:void 0,isSupported:function(){var a=e.width(),b=e.height();return 320===a&&460===b||1024===a&&672===b||1024===a&&692===b||1024===a&&691===b||768===a&&927===b||768===a&&928===b},isTouch:function(){return"undefined"!=typeof document.documentElement.ontouchstart},bind:function(){var a=this;e.on("orientationchange",function(){a.touchSupport(a.isSupported()),a.$el.removeClass("animating"),a.$children.removeClass("active"),$(".more-button").removeClass("hidden scrolling"),c.fitElement.isSupported()===!1?(d.removeClass("closed-nav"),d.addClass("no-snap")):(d.addClass("closed-nav"),d.removeClass("no-snap")),a.currentPage=0,a.setScrollTop(0),$(".elevator a").removeClass("selected"),$(".elevator a").eq(0).addClass("selected"),$(".page-wrapper").data("plugin_stellar")&&$(".page-wrapper").data("plugin_stellar").refresh(),c.fitElement.isTouch()&&c.fitElement.isSupported()&&void 0===$(".page-wrapper").data("plugin_stellar")&&$(".page-wrapper").stellar({horizontalScrolling:!1,scrollProperty:"transform",positionProperty:"transform",hideDistantElements:!1})}),this.$el.on("webkitTransitionEnd transitionend",function(b){b.target===a.$el[0]&&(a.$el.removeClass("animating"),$(".more-button").removeClass("scrolling"),c.fitElement.hideTimeout=setTimeout(function(){$(".elevator").addClass("hide")},2e3))}),$("nav.main .full-wrapper").on("touchend",function(a){a.stopPropagation()}).on("touchmove",function(a){a.preventDefault()});for(var b=this.$children.length-1,f=0;b>f;f++){var g=$('<a href="#" class="elevator-button" data-index="'+f+'"><span class="inner"></span></a>');$(".elevator").append(g)}$(".elevator a").eq(0).addClass("selected"),$(".elevator-trigger").on("click",this.elevator),$(".more-button-desktop").on("click",this.elevator),$(".more-button").on("click",function(){c.fitElement.currentPage<c.fitElement.$children.length-2&&(c.fitElement.currentPage++,c.fitElement.goTo())})},init:function(a,b){this.$el=$(a),this.$children=this.$el.find(b),this.bind(),this.isSupported()&&this.touchSupport(!0)},getScrollTop:function(a){a=a||this.$el;var b=a.css("transform");return"none"!==b?-1*parseInt(b.match(/(-?[0-9]+)/g)[5],10):0},setScrollTop:function(a){this.maxScrollTop=this.$el.height()-this.$children.eq(0).height(),1>a?a>=-this.maxScrollTop&&this.$el.css("transform","translate3d(0, "+a+"px, 0)"):this.$el.css("transform","translate3d(0, 0, 0)")},goNext:function(){return this.currentPage===this.$children.length-1?!1:(this.currentPage++,this.goTo(),!0)},goPrev:function(){return 0===this.currentPage?!1:(this.currentPage--,this.goTo(),!0)},goTo:function(){var a=this.$children.eq(this.currentPage),b=this.$el;this.currentPage?d.removeClass("closed-nav"):d.addClass("closed-nav"),clearTimeout(this.hideTimeout);var c=$(".elevator a"),e=$(".elevator a.selected"),f=$(".elevator");e.removeClass("selected"),c.eq(this.currentPage).addClass("selected"),f.removeClass("hide"),a.find(".carousel").first().hasClass("black")===!0||a.find(".rich-content").first().hasClass("black")===!0?f.addClass("black"):f.removeClass("black"),$(".more-button").addClass("scrolling"),$(".more-button").removeClass("hidden"),b.addClass("animating"),this.$children.removeClass("active"),a.addClass("active"),"Footer"!==a.data("template")?this.setScrollTop(-a.position().top):(f.addClass("hide"),this.setScrollTop(-(b.height()-this.$children.eq(0).height()))),this.currentPage>=1&&$(".more-button").addClass("hidden")},elevator:function(a){if(a.preventDefault(),c.fitElement.isSupported()===!0)$(".elevator a").removeClass("selected"),$(".elevator a").eq($(this).data("index")).addClass("selected"),c.fitElement.currentPage=+$(this).data("index"),c.fitElement.goTo();else{var b=$(".page-snap").eq($(this).data("index")).offset().top-$("nav.main").height();$("body").animate({scrollTop:b})}}},c.fitElement.touchSupport=function(a){var b,c,e,f,g,h,i="touchstart",j="touchmove",k="touchend",l=!1,m=function(d){var g=d.touches[0];e||a.$el.is(".animating")?d.preventDefault():(e=g.pageY,f=g.pageX,c=a.getScrollTop(),b.addEventListener(j,n,!1),b.addEventListener(k,o,!1))},n=function(b){var d=b.touches[0];h=d.pageY-e,g=d.pageX-f,l=Math.abs(g)>Math.abs(h),l||(b.preventDefault(),a.setScrollTop(h-c))},o=function(){!l&&Math.abs(h)>10?0>h?a.goNext():h>0&&a.goPrev():a.setScrollTop(-c),h=null,e=null,l=!1,b.removeEventListener(j,n,!1),b.removeEventListener(k,o,!1)};return function(c){return b=a.$el[0],c?(b.addEventListener(i,m,!1),a.currentPage?a.goTo():(d.addClass("closed-nav"),d.scrollTop(0)),d.addClass("page-snap-enabled"),void 0):(a.setScrollTop(0),a.currentPage=0,d.removeClass("page-snap-enabled closed-nav"),b.removeEventListener(i,m,!1))}}(c.fitElement),c.init=function(){c.fitElement.isSupported()===!1&&$(".home-splash").height($(window).height()-$("nav.main").height()),c.fitElement.init(".page-wrapper",".page-snap"),c.fitElement.isTouch()&&c.fitElement.isSupported()&&$(".page-wrapper").stellar({horizontalScrolling:!1,scrollProperty:"transform",positionProperty:"transform",hideDistantElements:!1})}}(window,window.App),function(a,b){"use strict";var c=b.Pages.Join={};c.SelectClub={},c.SelectMembership={},c.MembershipPurchase={},c.SelectClub.FindByZip=function(a,b){var c=APIEndpoint+"/facilities",d=$('input[name="SearchByZip.ZipCode"]').val();$.get(c,{zip:d,numberFacilities:5,radius:1e3},function(c){if(a&&"function"==typeof a)if(0===c.facilities.length)EQ.Geo.getLatLng(function(){EQ.Geo.getNearestClub(function(b){return null===b||void 0===b?(a(),!1):(debug("[GetNearestClub] ",b),$(".nearme").data("clubSelector").set(b),a(),void 0)})},b);else{var d=c.facilities[0];$(".nearme").data("clubSelector").set(d),a()}}).fail(function(){EQ.Geo.getLatLng(function(){EQ.Geo.getNearestClub(function(b){return null===b||void 0===b?(a(),!1):(debug("[GetNearestClub] ",b),$(".nearme").data("clubSelector").set(b),a(),void 0)})},b)})},c.SelectClub.bind=function(){$(".search").on("submit",function(a){a.preventDefault(),$(this).data("publicMethods").isValid()&&($('input[type="submit"]').data("original-text",$('input[type="submit"]').val()).val("Loading...").attr("disabled",!0),c.SelectClub.FindByZip(function(){$("form").addClass("is-hidden"),$(".nearme-wrapper").removeClass("is-hidden"),$(".tpl-ctacallout a").css("display","block"),setTimeout(function(){EQ.Maps.fixLayout()},16)},function(){$('input[type="submit"]').val($('input[type="submit"]').data("original-text")).attr("disabled",!1),$("form").find(".is-error").removeClass("hidden").text("Please try again later or enable Geolocation.")}),$('.nearme select[name="facilities"]').on("change",function(){var a=$(".nearme").data("clubSelector").get().ShortName;$(".tpl-ctacallout a").attr("href","/join/"+a)}))})},c.SelectClub.init=function(){c.SelectClub.bind()},c.SelectMembership.bind=function(){console.log("Step2 Init!"),$("a.join-now").on("click",function(a){a.preventDefault(),$(this).next("form").submit()})},c.SelectMembership.promotions=function(){var a=0;$(".membership-price-info").each(function(){console.log($(this).height()),$(this).height()>=a&&(a=$(this).height())}),$(".membership-price-info").height(a)},c.SelectMembership.init=function(){c.SelectMembership.bind(),c.SelectMembership.promotions(),$(window).on("resize",_.throttle(function(){c.SelectMembership.promotions()},400))},c.MembershipPurchase.Submit=function(){var a=APIEndpoint+"/registration/residential";$(".personal-information .submit").attr("disabled",!0),$(".personal-information .submit").val("Purchasing...");var b=$(".personal-info"),d=$(".billing-info"),e=b.find('input[name="Plan.CountryName"]').val(),f={firstName:b.find('input[name="MemberInformation.FirstName"]').val(),lastName:b.find('input[name="MemberInformation.LastName"]').val(),emailAddress:b.find('input[name="MemberInformation.EmailAddress"]').val(),phoneNumber:b.find('input[name="MemberInformation.PhoneNumber"]').val(),address:{street:b.find('input[name="MemberInformation.Address1"]').val(),"street-additional":b.find('input[name="MemberInformation.Address2"]').val(),city:b.find('input[name="MemberInformation.City"]').val(),state:"UK"!==e&&"CA"!==e?b.find('select[name="MemberInformation.State"]').val():"",province:"",zip:b.find('input[name="MemberInformation.ZipCode"]').val(),country:e,stateProvince:"US"!==e&&"CA"!==e?b.find('input[name="MemberInformation.State"]').val():b.find('select[name="MemberInformation.State"]').val()}},g={firstName:d.find('input[name="BillingInformation.FirstName"]').val(),lastName:d.find('input[name="BillingInformation.LastName"]').val(),emailAddress:d.find('input[name="BillingInformation.EmailAddress"]').val(),phoneNumber:d.find('input[name="BillingInformation.PhoneNumber"]').val(),address:{street:d.find('input[name="BillingInformation.Address1"]').val(),"street-additional":d.find('input[name="BillingInformation.Address2"]').val(),city:d.find('input[name="BillingInformation.City"]').val(),state:"UK"!==e&&"CA"!==e?d.find('select[name="BillingInformation.State"]').val():"",province:"",zip:d.find('input[name="BillingInformation.ZipCode"]').val(),country:e,stateProvince:"US"!==e&&"CA"!==e?d.find('input[name="BillingInformation.State"]').val():d.find('select[name="BillingInformation.State"]').val()}},h={facilityId:b.find('input[name="Plan.FacilityId"]').val(),membershipPlanId:b.find('input[name="Plan.PlanId"]').val(),countryId:b.find('input[name="sourceSystem"]').val(),member:f,billing:g,creditCard:{cardNumber:d.find('input[name="BillingInformation.CreditCardNumber"]').val(),expirationMonth:d.find('select[name="BillingInformation.ExpirationMonth"]').val(),expirationYear:d.find('select[name="BillingInformation.ExpirationYear"]').val(),cvc:d.find('input[name="BillingInformation.CreditCardSecurityCode"]').val()}};
$('input[name="usepersonal"]').is(":checked")&&(h.billing=h.member);var i=function(a){var b=$('.tpl-submitcallout input[type="submit"]');b.attr("disabled",!1),b.val(b.data("oldCopy")),$(".is-error").removeClass("hidden").text(a),$("body, html").animate({scrollTop:$(".is-error").offset().top-100})};$.ajax({type:"POST",url:a,contentType:"application/json",data:JSON.stringify(h),dataType:"json",success:function(a){a.error?i(a.error.message):(a=$.extend({facilityId:h.facilityId,emailAddress:b.find('input[name="MemberInformation.EmailAddress"]').val(),facilityRegion:b.find('input[name="Plan.Region"]').val(),membershipPlanId:h.membershipPlanId},a),c.MembershipPurchase.ThankYou(a))},error:function(a){i(a.responseJSON.error.message)}})},c.MembershipPurchase.ThankYou=function(a){if(!a.error){var b=$(".personal-info"),c=$("<form />");c.attr("action","/join/thank-you").attr("method","POST");var d=b.find('input[name="MemberInformation.FirstName"]').val(),e=$("div.total-due span.price strong").html(),f=$('<input type="hidden"/>').attr("name","Name").val(d.charAt(0).toUpperCase()+d.slice(1)),g=$('<input type="hidden"/>').attr("name","Charge").val(e),h=$('<input type="hidden"/>').attr("name","Card.Type").val(a.cardType),i=$('<input type="hidden"/>').attr("name","Card.Number").val(a.lastFour),j=$('<input type="hidden"/>').attr("name","Barcode").val(a.barcodeKey),k=$('<input type="hidden"/>').attr("name","FacilityId").val(a.facilityId),l=$('<input type="hidden"/>').attr("name","EmailAddress").val(a.emailAddress),m=$('<input type="hidden"/>').attr("name","FacilityRegion").val(a.facilityRegion),n=$('<input type="hidden"/>').attr("name","MembershipPlanId").val(a.membershipPlanId);c.append(f),c.append(g),c.append(h),c.append(i),c.append(j),c.append(k),c.append(l),c.append(m),c.append(n),$("body").append(c),c.submit()}},c.MembershipPurchase.bind=function(){$('input[name="usepersonal"]').on("change",function(){var a=$(this).is(":checked");console.log(a),$(".billing-info .information").toggle(!a),$(".billing-info .information input").attr("disabled",a),$(".billing-info .information select").attr("disabled",a)}),$('input[name="usepersonal"]').trigger("change"),$('.tpl-submitcallout input[type="submit"]').on("click",function(){var a=$('.tpl-submitcallout input[type="submit"]');$("form.personal-information").data("publicMethods").isValid()&&(a.attr("disabled",!0),a.data("oldCopy",a.val()),a.val("Loading..."),$("form.personal-information").submit())}),$("form.personal-information").on("submit",function(a){a.preventDefault(),c.MembershipPurchase.Submit()})},c.MembershipPurchase.init=function(){c.MembershipPurchase.bind()}}(window,window.App),function(a,b){"use strict";var c=b.Pages.Login={},d=$("form.login");c.validateAndSubmit=function(){d.data("publicMethods").isValid()&&d.data("publicMethods").sendAjaxRequest({username:"email",password:"password",persistLogin:"Login.RememberMe"},function(b,d,e){if(202===e.status){if("LegacyUser"===b.code)return void c.ChangeLegacyUserName(b);if("SpaOnlyUser"===b.code)return void c.RedirectToSpaPage(b)}var f=decodeURIComponent(EQ.Helpers.getQueryStringVariable("ReturnUrl"));if("false"===f){var g=b.hasAnsweredOnboardingQuestions||!1;a.location.href=g?"/":"/questionnaire/start"}else a.location.href=f})},c.ChangeLegacyUserName=function(a){var b=$("<form></form>");b.attr("action","/help/change/username").attr("method","POST");var c=$('<input type="hidden"/>').attr("name","email").val(a.email),d=$('<input type="hidden"/>').attr("name","userName").val(a.userName);b.append(c),b.append(d),$("body").append(b),b.submit()},c.RedirectToSpaPage=function(a){var b=$("<form />");b.attr("action","/help/upgrade/spa-member").attr("method","POST");var c=$('<input type="hidden"/>').attr("name","firstName").val(a.firstName),d=$('<input type="hidden"/>').attr("name","userId").val(a.userId),e=$('<input type="hidden"/>').attr("name","lastName").val(a.lastName);b.append(c),b.append(d),b.append(e),$("body").append(b),b.submit()},c.Facebook={bind:function(){$(".login-facebook").on("click",c.Facebook.intent.bind(c.Facebook))},intent:function(){window.track("regLoginWithFB"),this.getToken(function(b){debug("FBT:",b.accessToken),$.ajax(APIEndpoint+"/authentication/fblogin",{data:{accessToken:b.accessToken},type:"POST",xhrFields:{withCredentials:!0}}).done(function(b,d,e){if(202===e.status){if("LegacyUser"===b.code)return void c.ChangeLegacyUserName(b);if("SpaOnlyUser"===b.code)return void c.RedirectToSpaPage(b)}var f=decodeURIComponent(EQ.Helpers.getQueryStringVariable("ReturnUrl"));if("false"===f){var g=b.hasAnsweredOnboardingQuestions===!0;a.location.href=g?"/":"/questionnaire/start"}else a.location.href=f}).fail(function(b){try{var c=b.responseJSON,d=c.error?c.error.message:c.message;50019===c.error.messageId?FB.api("/me",function(b){a.location.href="/login/connect?firstName="+b.first_name+"&lastName="+b.last_name}):$(".is-error").text(d).removeClass("hidden")}catch(e){$(".is-error").text("").addClass("hidden"),debug("[FormSendAjaxRequest] Error logged into Crittercism:",e,arguments)}})})},getToken:function(a){FB.login(function(b){"connected"===b.status&&a(b.authResponse)},{scope:"email,user_likes,user_friends"})}},c.init=function(){debug("[Login] Init"),"undefined"!=typeof a.user&&a.user&&(a.location.href="/"),d.on("submit",function(a){a.preventDefault(),c.validateAndSubmit()}),b.Events.on("fbsdk:loaded",function(){c.Facebook.bind()})}}(window,window.App),function(a,b){"use strict";var c=b.Pages.Mock={},d=a._;c.Book={},c.Book.init=function(){debug("[Mock.Book] Init"),c.Book.bind()},c.Book.bind=function(){$(".bike-filters > li > a").on("click",function(){$(this).addClass("active"),$(this).find("input").focus()}),$(".bike-filters ul li a").on("click",function(){$(this).toggleClass("active")}),$(".remove-filter").on("click",function(a){a.stopPropagation(),$(this).prev().val(""),$(".bike-filters li a.active").removeClass("active")}),$(".bike-filters .checkbox").on("change",function(){var a=$(this).find(".label").text(),b=$(this).closest("ul[data-icon]").attr("data-icon"),c=$('<li data-filter="'+a+'" class="'+b+'"><span>'+a+"</span></li>");$(this).hasClass("checked")?c.appendTo(".added-filters"):$('.added-filters li[data-filter="'+a+'"]').remove()})},c.Book.drawMap=function(){var a,b=$(".bikes-graphic"),e=b.width(),f=c.Book.jsonMap,g=f.layout.width/e,h=f.layout.bikes,i=f.layout.doors;a=Math.floor(e*f.layout.heigth/f.layout.width),d.each(h,function(a){c.Book.drawBike(a,g)}),d.each(i,function(a){c.Book.drawDoor(a,g)})},c.Book.drawBike=function(a,b){var c=$(".bikes-graphic"),d=$('<div class="bike">'+a.localId+"</div>"),e=Math.floor(a.studioGridX/b),f=Math.floor(a.studioGridY/b);c.append(d),d.css({top:f+"px",left:e+"px"}),a.isDisabled===!0&&d.addClass("unavailable"),a.reserved===!0&&d.addClass("selected")},c.Book.drawDoor=function(a,b){var c=$(".bikes-graphic"),d=$('<div class="door icon-door"></div>'),e=Math.floor(a.studioGridX/b),f=Math.floor(a.studioGridY/b);c.append(d),d.css({top:f+"px",left:e+"px"})},c.Book.jsonMap={reservation:{result:null},layout:{clubId:113,clubName:"50th St. @ Broadway",heigth:475,width:925,id:104,name:"Cycling Studio",bikes:[{clubId:113,studioId:104,studioGridY:145,studioGridX:320,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:1415,isDisabled:!1,localId:1,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:90,studioGridX:320,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:1416,isDisabled:!1,localId:2,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:35,studioGridX:320,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:1417,isDisabled:!1,localId:3,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:145,studioGridX:420,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:1418,isDisabled:!1,localId:4,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:90,studioGridX:420,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:1419,isDisabled:!1,localId:5,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:35,studioGridX:420,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:1420,isDisabled:!1,localId:6,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:145,studioGridX:515,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:1421,isDisabled:!1,localId:7,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:90,studioGridX:515,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2747,isDisabled:!1,localId:8,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:35,studioGridX:515,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2839,isDisabled:!1,localId:9,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:140,studioGridX:690,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2840,isDisabled:!1,localId:10,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:195,studioGridX:690,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2841,isDisabled:!1,localId:11,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:250,studioGridX:690,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2842,isDisabled:!1,localId:12,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:305,studioGridX:690,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2843,isDisabled:!1,localId:13,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:360,studioGridX:690,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2844,isDisabled:!1,localId:14,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:415,studioGridX:690,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2845,isDisabled:!1,localId:15,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:195,studioGridX:605,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2846,isDisabled:!1,localId:16,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:250,studioGridX:605,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2847,isDisabled:!1,localId:17,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:305,studioGridX:605,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2848,isDisabled:!1,localId:18,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:360,studioGridX:605,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2849,isDisabled:!1,localId:19,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:415,studioGridX:605,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2850,isDisabled:!1,localId:20,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:410,studioGridX:480,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2851,isDisabled:!1,localId:21,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:410,studioGridX:415,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2852,isDisabled:!1,localId:22,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:410,studioGridX:350,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2853,isDisabled:!1,localId:23,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:410,studioGridX:290,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2854,isDisabled:!1,localId:24,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:410,studioGridX:230,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2855,isDisabled:!1,localId:25,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:410,studioGridX:165,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2856,isDisabled:!1,localId:26,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:410,studioGridX:55,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2857,isDisabled:!1,localId:27,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:300,studioGridX:445,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2858,isDisabled:!1,localId:28,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:300,studioGridX:330,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:3160,isDisabled:!1,localId:29,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:300,studioGridX:260,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:3612,isDisabled:!1,localId:30,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:300,studioGridX:190,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:3613,isDisabled:!1,localId:31,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:300,studioGridX:120,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:3614,isDisabled:!1,localId:32,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:300,studioGridX:55,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:3615,isDisabled:!1,localId:33,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1}],doors:[{clubId:113,studioId:104,studioGridY:35,studioGridX:695,gridItemTypeId:5,gridItemType:"Door - Bottom Left",gridItemImage:"doorBL.gif",reservableEquipId:null,isDisabled:null,localId:null,equipmentName:null,reserved:!1,reservedByUserSecId:null,equipmentId:null},{clubId:113,studioId:104,studioGridY:85,studioGridX:695,gridItemTypeId:5,gridItemType:"Door - Bottom Left",gridItemImage:"doorBL.gif",reservableEquipId:null,isDisabled:null,localId:null,equipmentName:null,reserved:!1,reservedByUserSecId:null,equipmentId:null}],instructors:[{clubId:113,studioId:104,studioGridY:55,studioGridX:100,gridItemTypeId:2,gridItemType:"Instructor",gridItemImage:"instructor.gif",reservableEquipId:null,isDisabled:null,localId:null,equipmentName:null,reserved:!1,reservedByUserSecId:null,equipmentId:null}]},strikes:{count:0,expiresOn:"2014-02-22T06:05:34.9173881-05:00"}}}(window,window.App),function(a,b){"use strict";b.Pages.Notifications={};var c=b.Pages.Notifications,d=Backbone.Model.extend({defaults:{description:"",time:moment().format("h:hh A"),type:0}}),e=Backbone.Collection.extend({model:d}),f=Backbone.View.extend({render:function(){var a,b=$(".notifications-container h2 .count",this.$el),c=$(".notifications",this.$el);return a=new g({collection:this.collection}),c.prepend(a.render().el),b.text(this.collection.length),this}}),g=Backbone.View.extend({className:"notification-group",template:_.template($("#notificationsGroupView").html()),render:function(){var a=this;return this.$el.html(this.template({date:"today"})),this.collection.each(function(b){var c=new h({model:b});a.$el.find(".notification-list").append(c.render().el)}),this}}),h=Backbone.View.extend({tagName:"li",className:"notification",template:_.template($("#notificationSingleView").html()),render:function(){var a=this.model.get("type"),b=1===a?"red":"yellow",c=moment(this.model.get("date")).format("h:hh A");return this.model.set("time",c),this.$el.addClass(b),this.$el.html(this.template(this.model.toJSON())),this}});c.init=function(){var a=$(".notifications-page"),b=moment().subtract("days",2);$.ajax({type:"GET",url:APIEndpoint+"/me/notifications?until="+b.format("YYYY-MM-DD"),contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",success:function(b){var c,d;debug("[NOTIFICATIONS SERVICE OK]",b),$.each(b,function(a,b){moment().isSame(moment(b.date).format("YYYY-MM-DD"))&&console.log(a),console.log(moment()),console.log(b.date)}),c=new e(b),d=new f({collection:c,el:a}),d.render()},error:function(a){debug("server error",a.responseJSON)}})}}(window,window.App),function(a,b){"use strict";var c=b.Pages.OnBoarding={},d=$(".page");c.Q1={bind:function(){debug("[onboarding] binding Q1 events");var a=this;$('#ContactOptions option[value="Twitter"]').remove(),this.form.on("submit",function(b){b.preventDefault(),a.saveForm(),window.track("regOnboardSubmit"),debug("[regOnboardSubmit] regOnboardSubmit event")}),$(document).find(".highlight").on("click",function(){window.track("regOnboardCancel"),debug("[regOnboardCancel] regOnboardCancel event")}),$(document).find("#onboard-skipQuestion").on("click",function(){window.track("regOnboardSkip"),debug("[regOnboardSkip] regOnboardSkip event")}),$(".question #anytime",this.form).on("change",function(){var a=$(".question .datetime-select",this.form);$(this).is(":checked")?a.addClass("hidden"):a.removeClass("hidden")})},saveForm:function(){var a=$("input[type=tel]",this.form),b=$("input[type=email]",this.form),d={email:function(a){return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(a)},usPhoneNumber:function(a){return/[01]?[- .]?(\([2-9]\d{2}\)|[2-9]\d{2})[- .]?\d{3}[- .]?\d{4}/.test(a)},ukPhoneNumber:function(a){return/\(?(?:(?:0(?:0|11)\)?[\s-]?\(?|\+)44\)?[\s-]?\(?(?:0\)?[\s-]?\(?)?|0)(?:\d{2}\)?[\s-]?\d{4}[\s-]?\d{4}|\d{3}\)?[\s-]?\d{3}[\s-]?\d{3,4}|\d{4}\)?[\s-]?(?:\d{5}|\d{3}[\s-]?\d{3})|\d{5}\)?[\s-]?\d{4,5}|8(?:00[\s-]?11[\s-]?11|45[\s-]?46[\s-]?4\d))(?:(?:[\s-]?(?:x|ext\.?\s?|\#)\d+)?)/.test(a)}},e="",f=1===window.user.SourceSystem||5===window.user.SourceSystem?d.usPhoneNumber(a.val()):d.ukPhoneNumber(a.val());if(b.length>0?""!==b.val()&&d.email(b.val())?b.removeClass("error"):(b.addClass("error"),e="Please check your email."):a.length>0&&(""!==a.val()&&f?a.removeClass("error"):(a.addClass("error"),e="Please check your Phone number.")),this.form.find(".error").length>0)return void c.dispayError(e);$("form .is-error").addClass("hidden");var g={facilityId:$(".club select option:selected",this.form).data("facility-id"),email:b.length>0?b.val():"",phoneNumber:a.length>0?a.val():"",comments:$("textarea[id=message]",this.form).val(),isAnytime:!1,preferredDay:"",preferredTime:"",refreshCache:!0},h=$("input[id=anytime]",this.form).prop("checked");h?g.isAnytime=!0:(g.preferredDay=$("select[id=DayOptions]",this.form).val(),g.preferredTime=$("select[id=TimeOptions]",this.form).val());var i=$("form").find('input[type="submit"]');i.data("old-copy",i.val()),i.val("Loading...").attr("disabled",!0);var j=APIEndpoint+"/personal-training/schedule-equifit-assessment";$.ajax({url:j,contentType:"application/json",data:JSON.stringify(g),type:"POST",xhrFields:{withCredentials:!0}}).done(function(a){debug("ONBOARDING RESPONSE",a),c.redirect()}).fail(function(){debug("Server Error");var a=$("form").find('input[type="submit"]');a.val(a.data("old-copy")).attr("disabled",!1)})},init:function(){this.form=$("form.join-schedule-form"),this.bind()}},c.Q2={bind:function(){debug("[onboarding] binding Q2 events");var a=this;this.form.on("submit",function(b){b.preventDefault(),a.saveForm(),window.track("regOnboardSubmit"),debug("[regOnboardSubmit] regOnboardSubmit event")}),$(document).find(".highlight").on("click",function(){window.track("regOnboardCancel"),debug("[regOnboardCancel] regOnboardCancel event")}),$(document).find("#onboard-skipQuestion").on("click",function(){window.track("regOnboardSkip"),debug("[regOnboardSkip] regOnboardSkip event")})},saveForm:function(){var a,b=$("input[name=questionId]",this.form).val(),d=$("input[name=answer]",this.form).val();a={questionId:b,answerId:d,answerText:"",isSelected:!0},c.updateAnswers(a,c.redirect,!0)},init:function(){this.form=$("form"),this.bind()}},c.Q3={bind:function(){debug("[onboarding] binding Q3_Q4 events");var a=this,b=$("textarea[name=otherAnswerText]",a.form);$(document).find(".highlight").on("click",function(){window.track("regOnboardCancel"),debug("[regOnboardCancel] regOnboardCancel event")}),$(document).find("#onboard-skipQuestion").on("click",function(){window.track("regOnboardSkip"),debug("[regOnboardSkip] regOnboardSkip event")}),a.form.on("submit",function(b){b.preventDefault(),a.saveForm(),window.track("regOnboardSubmit"),debug("[regOnboardSubmit] regOnboardSubmit event")}),$("label.check-selector",a.form).on("click",function(){a.toggleCheck($(this))}),b.length&&b.on("change",function(){a.toggleAnswer(b)})},toggleAnswer:function(a){""!==a.val()?this.checkCount<this.maxSelections&&this.checkCount++:this.checkCount>0&&this.checkCount--,this.toggleSelections()},toggleCheck:function(a){var b=a.find("input[type=checkbox]");1===this.maxSelections&&($("label.check-selector input[type=checkbox]").each(function(){$(this).val()!==b.val()&&($(this).prop("checked",!1),$(this).parents("label.check-selector").removeClass("checked"))}),b.not(":checked")&&(a.removeClass("checked"),this.checkCount>0&&this.checkCount--)),b.is(":checked")&&this.checkCount<this.maxSelections&&!a.hasClass("checked")?(a.addClass("checked"),this.checkCount++):a.hasClass("checked")&&(a.removeClass("checked"),this.checkCount>0&&this.checkCount--),this.toggleSelections()},toggleSelections:function(){this.checkCount===this.maxSelections?(1!==this.maxSelections&&$("label.check-selector input[type=checkbox]").not(":checked").each(function(){$(this).prop("disabled",!0)}),""===$("textarea[name=otherAnswerText]",this.form).val()&&$("textarea[name=otherAnswerText]",this.form).prop("disabled",!0)):this.checkCount<this.maxSelections&&($("label.check-selector input[type=checkbox][disabled]").each(function(){$(this).prop("disabled",!1)}),""===$("textarea[name=otherAnswerText]",this.form).val()&&$("textarea[name=otherAnswerText]",this.form).prop("disabled",!1))},loadForm:function(){var a=parseInt($("input[name=questionId]",this.form).val(),10),b=c.getAnswerByQID(a),d=[],e=this;b&&(d=_.uniq(_.flatten(b,"answerId")),$.each(d,function(a,c){if(e.checkCount<e.maxSelections){var d=$("input[value="+c+"]",e.form);d.prop("checked",!0),d.parent("label.check-selector").addClass("checked"),e.checkCount++,debug("LOADED FORM",b[a])}})),this.toggleSelections()},saveForm:function(){var a,b=parseInt($("input[name=questionId]",this.form).val(),10),d=$("input[name=answers]:checked",this.form),e={id:$("input[name=otherAnswerId]",this.form).val(),text:$("textarea[name=otherAnswerText]",this.form).val(),isDefault:!1},f=d.length,g={questions:[]},h={questionId:b,answers:[]},i=!0;""!==e.id&&""!==e.text&&f++,0!==f&&f<=this.maxSelections?(0===d.length&&e.id&&""!==e.text?h.answers.push({answerId:e.id,answerText:e.text,isSelected:!0}):1===d.length?h.answers.push({answerId:d.val(),isSelected:!0}):d.length>1?($.each(d,function(a,b){h.answers.push({answerId:$(b).val(),isSelected:!0})}),!e.isDefault&&e.id&&h.answers.push({answerId:e.id,answerText:e.text,isSelected:!0})):(i=!1,a="You need to select at least one option.",c.dispayError(a),debug("VALIDATION ERROR",f,this.maxSelections)),i&&(g.questions.push(h),$("form .is-error").addClass("hidden"),c.updateAnswers(g,c.redirect))):0===f?(a="You need to select at least one option.",c.dispayError(a),debug("VALIDATION ERROR",f,this.maxSelections)):(a=1===this.maxSelections?"option":"options",a="You can't select more than "+this.maxSelections+" "+a+".",c.dispayError(a),debug("VALIDATION ERROR",f,this.maxSelections))},init:function(){this.form=$("form"),this.maxSelections=parseInt($("input[name=maxSelections]",this.form).val(),10),this.checkCount=0,this.loadForm(),this.bind()}},c.Q4=c.Q3,c.Q5={bind:function(){debug("[onboarding] binding Q5 events");var a=this;this.form.on("submit",function(b){b.preventDefault(),a.saveForm(),window.track("regOnboardSubmit"),debug("[regOnboardSubmit] regOnboardSubmit event")}),$(document).find(".highlight").on("click",function(){window.track("regOnboardCancel"),debug("[regOnboardCancel] regOnboardCancel event")}),$(document).find("#onboard-skipQuestion").on("click",function(){window.track("regOnboardSkip"),debug("[regOnboardSkip] regOnboardSkip event")})},loadForm:function(){this.form.find("fieldset").each(function(){if(0!==$(this).find('input[type="radio"]').length){var a=$(this).find('input[type="radio"]').attr("name").match(/\d$/)[0],b=c.getAnswerByQID(a);b&&b.forEach(function(a){$("input[value="+a.answerId+"]").prop("checked",a.isSelected).trigger("change")})}})},saveForm:function(){var a,b={questions:[]},d=!0;this.form.find("fieldset").each(function(){if(0!==$(this).find('input[type="radio"]').length){var a=[];$(this).find('input[type="radio"]:checked').each(function(){a.push({answerId:$(this).val(),isSelected:$(this).is(":checked")})}),b.questions.push({questionId:$(this).find('input[type="radio"]').attr("name").match(/\d$/)[0],answers:a}),0===a.length&&(d=!1)}}),d?c.updateAnswers(b,c.redirect):(a="You need to answer all the questions.",c.dispayError(a))},init:function(){this.form=$("form"),this.bind(),this.loadForm()}},c.Q6={init:function(){$(document).find(".highlight").on("click",function(){window.track("regOnboardCancel"),debug("[regOnboardCancel] regOnboardCancel event")})}},c.updateAnswers=function(a,b,c){var d;d=c?APIEndpoint+"/personalization/onboarding/questions/me/updateanswer":APIEndpoint+"/personalization/onboarding/questions/me/update",debug("SENDING DATA",a);var e=$("form").find('input[type="submit"]');e.data("old-copy",e.val()),e.val("Loading...").attr("disabled",!0),$.ajax({url:d,contentType:"application/json",data:JSON.stringify(a),type:"POST",xhrFields:{withCredentials:!0}}).done(function(a){debug("ONBOARDING RESPONSE",a),b()}).fail(function(){debug("Server Error");var a=$("form").find('input[type="submit"]');a.val(a.data("old-copy")).attr("disabled",!1)})},c.getAnswerByQID=function(a){var b=!1;return c.data&&$.each(c.data,function(c,d){d.questionId===a&&(b=d.answers)}),b},c.dispayError=function(a){var b=$("form .is-error");b.text(a).removeClass("hidden"),$("html, body").animate({scrollTop:b.offset().top-150},500)},c.redirect=function(){var a=$("form input[name=nextPage]").val();a&&(window.location=a)},c.start=function(a){debug("[OnBoarding] guid",a),"true"===window.EQ.Helpers.readCookie("from_ios")&&window.EQ.Helpers.tryFastAppSwitch()},c.init=function(a){debug("[OnBoarding] Init at step",a),d.addClass("full-bleed onboarding"),$.ajax({url:APIEndpoint+"/personalization/onboarding/questions/me",contentType:"application/json",data:{questionTypes:"OnBoarding"},type:"GET",xhrFields:{withCredentials:!0}}).done(function(b){debug("ONBOARDING RESPONSE",b),c.data=b.answeredQuestions,a&&c["Q"+a]&&c["Q"+a].init(),"start"===a&&($(document).find("#onboard-startBtn").on("click",function(){window.track("regOnboardSubmit")}),$(document).find(".highlight").on("click",function(){window.track("regOnboardCancel")}))}).fail(function(){debug("Server Error")})}}(window,window.App),function(a,b){"use strict";var c=b.Pages.Password={},d=$(".recover-password"),e=$(".reset-password");c.Forgot={},c.Reset={},c.Forgot.init=function(){debug("[forgotPassword] Init"),c.Forgot.bind()},c.Forgot.bind=function(){var a=c.Forgot;d.on("submit",function(b){b.preventDefault(),a.validateAndSubmit()})},c.Forgot.validateAndSubmit=function(){d.data("publicMethods").isValid()&&d.data("publicMethods").sendAjaxRequest({email:"RecoverPassword.UserName"},function(){var a=$(".password-recover-confirmation"),b=d.data("publicMethods").getData()["RecoverPassword.UserName"];a.removeClass("hidden"),debug("[regForgotPWEmlSent] Success fully retrived"),window.track("regForgotPWEmlSent"),a.find(".user-email").text(b),d.add(".lost-credentials").add(".tpl-subtitleparagraphcallout.dtm-password-subtitleparagraphcallout").addClass("hidden"),$("body, html").animate({scrollTop:0})})},c.Reset.init=function(){debug("[resetPassword] Init"),c.Reset.bind()},c.Reset.bind=function(){var a=c.Reset;e.on("submit",function(b){b.preventDefault(),a.validateAndSubmit(),debug("[validateAndSubmit] called")})},c.Reset.validateAndSubmit=function(){e.data("publicMethods").isValid()&&e.data("publicMethods").sendAjaxRequest({url:"ResetPassword.url",lastName:"ResetPassword.LastName",password:"ResetPassword.NewPassword"},function(){a.location.href="/"})}}(window,window.App),function(a,b){"use strict";var c=b.Pages.Rewards={};c.$view={details:$("#rewardDetails"),history:$("#rewardHistory")},c.printGiftCard=function(a){debug("[Rewards] print gift card",a),window.open(APIEndpoint+a.data("url"))},c.activateGiftCard=function(a){debug("[Rewards] activate Gift Card",a);var b={url:a.data("url"),method:a.data("method"),data:{id:a.data("id")},callback:function(){c.reloadPage()}};this.ajaxManager(b)},c.withdrawPass=function(a){debug("[Rewards] withdraw pass",a);var b={url:a.data("url"),method:a.data("method"),data:{id:a.data("id")},callback:function(){c.reloadPage()}};this.ajaxManager(b)},c.ajaxManager=function(a){a=a||{},$.ajax(this.ENDPOINT+a.url,{data:JSON.stringify(a.data),contentType:"application/json",type:a.method,xhrFields:{withCredentials:!0},crossDomain:!0}).done(function(b){a.callback(b)}).fail(function(a,b,d){debug("[Rewards] Error",a,b,d),c.error(a,b,d)})},c.error=function(a,b,d){debug("[Rewards] error",a,b,d);var e=JSON.parse(a.responseText);console.log("message",e),c.$view.details.html('<h2 class="title paragraph">'+e.error.message+"</h2>")},c.reloadPage=function(){location.reload(!0)},c.bind=function(){this.$view.details.on("click",".print",function(a){a.preventDefault(),c.printGiftCard($(a.currentTarget))}),this.$view.details.on("click",".activate",function(a){a.preventDefault(),c.activateGiftCard($(a.currentTarget))}),this.$view.history.on("click",".withdraw",function(a){a.preventDefault(),c.withdrawPass($(a.currentTarget))
})},c.init=function(){c.ENDPOINT=APIEndpoint,c.bind()}}(window,window.App),function(a,b){"use strict";var c,d=b.Pages.ScheduleEquifit={},e=$(".page");d.Form={bind:function(){debug("[ScheduleEquifit] binding events");var a=this;$('#ContactOptions option[value="Twitter"]').remove(),this.form.on("submit",function(b){b.preventDefault(),a.saveForm(),window.track("regScheduleEquifitSubmit"),debug("[regScheduleEquifitSubmit] regScheduleEquifitSubmit event")}),$(document).find(".highlight").on("click",function(){window.track("regScheduleEquifitCancel"),debug("[regScheduleEquifitCancel] regScheduleEquifitCancel event")}),$(".question #anytime",this.form).on("change",function(){var a=$(".question .datetime-select",this.form);$(this).is(":checked")?a.addClass("hidden"):a.removeClass("hidden")})},saveForm:function(){var a=$("input[type=tel]",this.form),b=$("input[type=email]",this.form),e={email:function(a){return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(a)},usPhoneNumber:function(a){return/[01]?[- .]?(\([2-9]\d{2}\)|[2-9]\d{2})[- .]?\d{3}[- .]?\d{4}/.test(a)},ukPhoneNumber:function(a){return/\(?(?:(?:0(?:0|11)\)?[\s-]?\(?|\+)44\)?[\s-]?\(?(?:0\)?[\s-]?\(?)?|0)(?:\d{2}\)?[\s-]?\d{4}[\s-]?\d{4}|\d{3}\)?[\s-]?\d{3}[\s-]?\d{3,4}|\d{4}\)?[\s-]?(?:\d{5}|\d{3}[\s-]?\d{3})|\d{5}\)?[\s-]?\d{4,5}|8(?:00[\s-]?11[\s-]?11|45[\s-]?46[\s-]?4\d))(?:(?:[\s-]?(?:x|ext\.?\s?|\#)\d+)?)/.test(a)}},f="",g=1===window.user.SourceSystem||5===window.user.SourceSystem?e.usPhoneNumber(a.val()):e.ukPhoneNumber(a.val());if(b.length>0?""!==b.val()&&e.email(b.val())?b.removeClass("error"):(b.addClass("error"),f="Please check your email."):a.length>0&&(""!==a.val()&&g?a.removeClass("error"):(a.addClass("error"),f="Please check your Phone number.")),this.form.find(".error").length>0)return void d.dispayError(f);$("form .is-error").addClass("hidden");var h={facilityId:$(".club select option:selected",this.form).data("facility-id"),email:b.length>0?b.val():"",phoneNumber:a.length>0?a.val():"",comments:$("textarea[id=message]",this.form).val(),isAnytime:!1,preferredDay:"",preferredTime:"",refreshCache:!0},i=$("input[id=anytime]",this.form).prop("checked");i?h.isAnytime=!0:(h.preferredDay=$("select[id=DayOptions]",this.form).val(),h.preferredTime=$("select[id=TimeOptions]",this.form).val());var j=$("form").find('input[type="submit"]');j.val("Loading...").attr("disabled",!0);var k=APIEndpoint+"/personal-training/schedule-equifit-assessment";$.ajax({url:k,contentType:"application/json",data:JSON.stringify(h),type:"POST",xhrFields:{withCredentials:!0}}).done(function(a){debug("ScheduleEquifit RESPONSE",a),c.form.hide(),c.$thankContainer.removeClass("hidden"),$("html, body").animate({scrollTop:c.$thankContainer.offset().top-150},500)}).fail(function(){debug("Server Error"),c.form.hide(),c.$errorContainer.removeClass("hidden"),$("html, body").animate({scrollTop:c.$errorContainer.offset().top-150},500)})},init:function(){c=this,this.form=$("form.join-schedule-form"),this.$thankContainer=$(".schedule-equifit-thanks"),this.$errorContainer=$(".schedule-equifit-error"),this.bind()}},d.dispayError=function(a){var b=$("form .is-error");b.text(a).removeClass("hidden"),$("html, body").animate({scrollTop:b.offset().top-150},500)},d.init=function(){debug("[ScheduleEquifit] Init"),e.addClass("full-bleed schedule-equifit"),d.Form.init()}}(window,window.App),function(a,b){"use strict";var c=b.Pages.SignIn={},d=$(".tpl-memberimagetextcallout div").data("template-data"),e=$(".eq-sign-in"),f=$(".signup-facebook-withoutemail");c.FacebookWithOutEmail={},c.init=function(){debug("[SignIn] Init"),console.log(d),c.bind()},c.bind=function(){var a=c;this.fbLogin.bind(),e.on("click",function(b){b.preventDefault(),a.submit()})},c.fbLogin={bind:function(){$(".fb-login").on("click",c.fbLogin.intent.bind(c.fbLogin))},intent:function(){window.track("regSignupWithFB"),this.getToken(function(b){debug("FBT:",b);var e={barcodeId:d.BarcodeId,fbAccessToken:b,sourceSystem:d.SourceSystem,lastName:d.LastName,firstName:d.FirstName};$.ajax(APIEndpoint+"/registration/signupwithfacebook",{data:JSON.stringify(e),contentType:"application/json",type:"POST",xhrFields:{withCredentials:!0}}).done(function(){debug("[FB SignUP] Success"),window.tagData=window.tagData||{},window.tagData.registration={success:"true",type:"fb"},window.track("registration",window.tagData.registration),$.ajax(APIEndpoint+"/authentication/fblogin",{data:{accessToken:e.fbAccessToken},type:"POST",xhrFields:{withCredentials:!0}}).done(function(){debug("[FBLogin] Success"),a.location.href="/"}).fail(function(a){var b=a.responseJSON&&a.responseJSON.message;debug("[FBLogin] Failed",b),b&&$(".is-error").removeClass("hidden").text(b)})}).fail(function(a){if(40021===a.responseJSON.messageId)return c.redirectToFacebookWithSigninEmail(e);var b=a.responseJSON&&a.responseJSON.message;debug("[FBLogin] Failed",b),b&&$(".is-error").removeClass("hidden").text(b)})})},getToken:function(a){FB.login(function(b){"connected"===b.status&&a(b.authResponse.accessToken)},{scope:"email,user_likes,user_friends"})}},c.submit=function(){var a=$("<form></form>");a.attr("action","/activate/signin/equinox").attr("method","POST");var b=$('<input type="hidden"/>').attr("name","LastName").val(d.LastName),c=$('<input type="hidden"/>').attr("name","Country").val(d.SourceSystem),e=$('<input type="hidden"/>').attr("name","Barcode").val(d.BarcodeId);a.append(b),a.append(c),a.append(e),$("body").append(a),a.submit()},c.redirectToFacebookWithSigninEmail=function(a){var b=$("<form></form>");b.attr("action","/activate/signin/facebook/email").attr("method","POST");var c=$('<input type="hidden"/>').attr("name","LastName").val(a.lastName),d=$('<input type="hidden"/>').attr("name","FirstName").val(a.firstName),e=$('<input type="hidden"/>').attr("name","Country").val(a.sourceSystem),f=$('<input type="hidden"/>').attr("name","Barcode").val(a.barcodeId),g=$('<input type="hidden"/>').attr("name","FbToken").val(a.fbAccessToken);b.append(c),b.append(e),b.append(d),b.append(f),b.append(g),$("body").append(b),b.submit()},c.FacebookWithOutEmail.init=function(){debug("[FacebookWithOutEmail] Init"),c.FacebookWithOutEmail.bind()},c.FacebookWithOutEmail.bind=function(){var a=c.FacebookWithOutEmail;f.on("submit",function(b){b.preventDefault(),a.validateAndSubmit()})},c.FacebookWithOutEmail.validateAndSubmit=function(){f.data("publicMethods").isValid()&&f.data("publicMethods").sendAjaxRequest({sourceSystem:"country",barcodeId:"barcode",lastName:"lastName",FacebookAccessToken:"fbAccessToken",email:"EmailForm.EmailLabel"},function(){var a=$(".facebook-confirmation"),b=f.data("publicMethods").getData()["EmailForm.EmailLabel"];a.removeClass("hidden"),a.find(".user-email").text(b),f.add(".lost-credentials").add(".tpl-subtitleparagraphcallout.dtm-password-subtitleparagraphcallout").addClass("hidden"),$("body, html").animate({scrollTop:0})})}}(window,window.App),function(a,b){"use strict";var c=b.Pages.User={},d=$(".recover-username"),e=$(".change-username"),f=$(".verify-username"),g=$(".spa-member-upgrade");c.Forgot={},c.ChangeUserName={},c.VerifyUserName={},c.SpaMemberUpgrade={},c.Forgot.init=function(){debug("[forgotUser] Init"),c.Forgot.bind()},c.Forgot.bind=function(){var a=c.Forgot;d.on("submit",function(b){b.preventDefault(),a.validateAndSubmit()})},c.Forgot.validateAndSubmit=function(){d.data("publicMethods").isValid()&&d.data("publicMethods").sendAjaxRequest({country:"country",barcode:"RecoverUserName.Barcode",lastName:"RecoverUserName.LastName"},function(a){debug("[forgotUser] Callback"),$(".user-recover-confirmation").removeClass("hidden"),window.track("regForgotUsername"),debug("[regForgotUsername] tracking event for regForgotUsername"),$(".confirmation-message-module").data("templateData",{firstName:a.firstName,email:a.email}).data("publicMethods").render(),d.add(".tpl-subtitleparagraphcallout.dtm-user-subtitleparagraphcallout").add(".lost-credentials").addClass("hidden"),$("body, html").animate({scrollTop:0})})},c.ChangeUserName.init=function(){debug("[changeUserName] Init"),c.ChangeUserName.bind()},c.ChangeUserName.bind=function(){var a=c.ChangeUserName;e.on("submit",function(b){b.preventDefault(),a.validateAndSubmit()})},c.ChangeUserName.validateAndSubmit=function(){e.data("publicMethods").isValid()&&e.data("publicMethods").sendAjaxRequest({email:"LoginWithEmailForm.EmailLabel",password:"password",username:"username"},function(){var a=$(".change-username-confirmation"),b=e.data("publicMethods").getData()["LoginWithEmailForm.EmailLabel"];a.removeClass("hidden"),a.find(".user-email").text(b),e.add(".tpl-subtitleparagraphcallout.dtm-password-subtitleparagraphcallout").addClass("hidden"),$("body, html").animate({scrollTop:0})})},c.VerifyUserName.init=function(){debug("[verifyUserName] Init"),c.VerifyUserName.bind()},c.VerifyUserName.bind=function(){var a=c.VerifyUserName;f.on("submit",function(b){b.preventDefault(),a.validateAndSubmit()})},c.VerifyUserName.validateAndSubmit=function(){f.data("publicMethods").isValid()&&f.data("publicMethods").sendAjaxRequest({url:"SumbitEmailModel.Token",password:"SumbitEmailModel.Password"},function(){"true"===window.EQ.Helpers.readCookie("from_ios")&&window.EQ.Helpers.tryFastAppSwitch(),a.location.href=decodeURIComponent(EQ.Helpers.getQueryStringVariable("ReturnUrl")||"/")})},c.SpaMemberUpgrade.init=function(){debug("[SpaMemberUpgrade] Init"),c.SpaMemberUpgrade.bind()},c.SpaMemberUpgrade.bind=function(){var a=c.SpaMemberUpgrade;g.on("submit",function(b){b.preventDefault(),a.validateAndSubmit()})},c.SpaMemberUpgrade.validateAndSubmit=function(){g.data("publicMethods").isValid()&&g.data("publicMethods").sendAjaxRequest({userId:"userId",country:"country",barcode:"SpaForm.BarcodeLabel",lastName:"SpaForm.LastNameLabel"},function(){a.location.href=decodeURIComponent(EQ.Helpers.getQueryStringVariable("ReturnUrl")||"/")})}}(window,window.App),function(a){"use strict";var b=function(b,c,d){return a.Components[b](c,d)};a.renderComponents=function(a){var c=$(a),d=[],e=[];c.find("[data-component]").each(function(a,b){var c=$(b),f=c.data("component"),g=c.data("component-options");try{debug("[DataComponent] Loading: "+f+" component.");var h={filename:"/assets/js/app/components/min/"+f+".js",$el:c,component:f,options:g};d.push(h),e.push(h.filename)}catch(i){console.error("data-component not found: "+f,i.stack)}});try{require(e,function(){_.forEach(d,function(a){b(a.component,a.$el,a.options||{})})})}catch(f){console.error("data-component not found",f.stack)}},a.loadComponent=function(a,c,d){debug("[DataComponent] Loading: "+a+" component."),require(["/assets/js/app/components/min/"+a+".js"],function(){b(a,c,d||{})})},a.renderComponents("body"),_.extend(Backbone.View.prototype,Backbone.Events,{renderComponents:function(b){a.renderComponents(b)}})}(window.App),window.App.Events.trigger("loaded"),function(){"use strict";$(function(){"android"===EQ.Helpers.getDevicePlatform()&&$("input[maxlength]").each(function(){var a=$(this),b=a.attr("maxlength");a.removeAttr("maxlength"),a.on("keydown",function(c){var d=[8,9,13,33,34,35,36,37,38,39,40,46],e=c.altKey||c.ctrlKey;return-1!==$.inArray(c.keyCode,d)||e?void 0:a.val().length<b}),a.on("keyup",function(){var c=a.val();c.length>b&&a.val(c.substr(0,b))})}),"#flushGeoCache"===window.location.hash&&(EQ.Geo.flushCache(),console.log("[GLOBAL] Flushing Geo Cache")),EQ.Helpers.fixRegionProperty()})}(window);
//# sourceMappingURL=app.min.js.map
/*! mindoro v0.7.0 - 2014-06-21 04:06:40 */
