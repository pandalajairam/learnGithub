!function(global){"use strict";var App=global.App={};App.IS_DEV=0===location.hostname.indexOf("local"),App.Pages={},App.Components={},App.Events=$({}),App.Services={findByGeo:"/ESB/FindFacilitiesByGeo"},App.Events.on("loaded",function(){var Router=Backbone.Router.extend({_routeToRegExp:function(route){return route+="(/)",route=Backbone.Router.prototype._routeToRegExp.call(this,route),new RegExp(route.source,"i")},routes:{"":App.Pages.Home.init,"Join/Step1":App.Pages.Join.SelectClub.init,"Join/Step3":App.Pages.Join.MembershipPurchase.init,"Join/:facilityId":App.Pages.Join.SelectMembership.init,Login:App.Pages.Login.init,"Help/ForgotPassword":App.Pages.Password.Forgot.init,"Help/Recover-Password/:token":App.Pages.Password.Reset.init,"Help/Change/UserName":App.Pages.User.ChangeUserName.init,"help/upgrade/spa-member":App.Pages.User.SpaMemberUpgrade.init,"Help/forgotUser":App.Pages.User.Forgot.init,"login/connect":App.Pages.ConnnectAccounts.init,bookabike:App.Pages.Mock.Book.init,"bookabike/detail":App.Pages.Mock.Book.init,"Activate/start":App.Pages.Activate.init,"Activate/verifyemail/:token":App.Pages.User.VerifyUserName.init,"activate/signin":App.Pages.SignIn.init,"activate/signin/equinox":App.Pages.CreateAccount.init,Clubs:App.Pages.Clubs.init,"modules/clubslanding":App.Pages.Clubs.init,"Regions/:region":App.Pages.Clubs.init,"Clubs/:club":App.Pages.Facilities.init,"Clubs/:region/:club":App.Pages.Facilities.init,"Clubs/:region/:subregion/:club":App.Pages.Facilities.init,"questionnaire/:step":App.Pages.OnBoarding.init,groupfitness:App.Pages.GroupFitness.init,"groupfitness/:id":App.Pages.ClassDetail.init,notifications:App.Pages.Notifications.init}});if(App.Router=new Router,Backbone.history.start({hashChange:!1,pushState:!0}),$.ajaxSetup({cache:!1}),isDebugging){var mock=function(){return this};global.Crittercism={logHandledException:mock,leaveBreadcrumb:mock,setUsername:mock,setValue:mock}}else console.log=function(){},Crittercism.init({appId:"525628e8a7928a3b36000003",appVersion:assemblyVersion+" "+assemblyServer})})}(window),function(global,App){"use strict";var Activate=App.Pages.Activate={},$activateForm=$(".activate-user");Activate.init=function(){debug("[Activate] Init"),Activate.bind()},Activate.bind=function(){var that=Activate;$activateForm.on("submit",function(e){e.preventDefault(),that.validateAndSubmit()})},Activate.validateAndSubmit=function(){$activateForm.data("publicMethods").isValid()&&$activateForm.data("publicMethods").sendAjaxRequest({country:"ActivateUser.Country",barcode:"ActivateUser.Barcode",lastName:"ActivateUser.LastName"},function(data){var $form=$("<form></form>");$form.attr("action","/activate/signin").attr("method","POST");var $firstName=$('<input type="hidden"/>').attr("name","FirstName").val(data.firstName),$email=$('<input type="hidden"/>').attr("name","Email").val(data.emailAddress),$country=$('<input type="hidden"/>').attr("name","LastName").val($activateForm.find('input[name="ActivateUser.LastName"]').val()),$lastName=$('<input type="hidden"/>').attr("name","Country").val($activateForm.find('select[name="ActivateUser.Country"]').val()),$barcode=$('<input type="hidden"/>').attr("name","Barcode").val($activateForm.find('input[name="ActivateUser.Barcode"]').val());$form.append($country),$form.append($firstName),$form.append($lastName),$form.append($email),$form.append($barcode),$form.submit()})}}(window,window.App),function(App){"use strict";var ClassDetail=App.Pages.ClassDetail={},Item=Backbone.Model.extend({defaults:{id:"",type:"",selected:!1,displayName:""}}),ItemCollection=Backbone.Collection.extend(),FavoritesContainerView=Backbone.View.extend({el:".favorites-class-container",initialize:function(options){this.options=options||{}},render:function(){var itemCollection=new ItemCollection,favoritesButtonView=new FavoritesButtonView,favoritesListView=new FavoritesListView({collection:itemCollection,favoritesData:this.options.favoritesData,updateCallback:favoritesButtonView.updateCount.bind(favoritesButtonView)});favoritesButtonView.render(),favoritesListView.render()}}),FavoritesButtonView=Backbone.View.extend({el:".favorites-button",updateCount:function(number){var content="";0!==number&&(content="("+number+")"),this.$el.find(".favorite-count").text(content)},render:function(){var that=this;this.$el.on("click",function(){that.$el.toggleClass("active")})}}),FavoritesListView=Backbone.View.extend({el:".favorites-list",initialize:function(options){this.options=options||{}},updateCount:function(){var count=0;this.collection.each(function(item){item.get("selected")&&count++}),this.options.updateCallback(count)},render:function(){var that=this;this.$el.find("li").each(function(index,element){var item,favoritesListSingleView,type=$(element).attr("data-type"),id=parseInt($(element).attr("data-id"),10),data=that.options.favoritesData,selected=!1;-1!==_.findIndex(data[type],{id:id})&&(selected=!0),item=new Item({displayName:$(element).find("strong").text(),type:type,id:id,selected:selected}),that.collection.add(item),favoritesListSingleView=new FavoritesListSingleView({el:element,model:item,updateCallback:that.updateCount.bind(that)}),favoritesListSingleView.render()})}}),FavoritesListSingleView=Backbone.View.extend({model:Item,initialize:function(options){this.options=options||{}},toggleSelected:function(){this.model.set("selected",!this.model.get("selected")),this.options.updateCallback(),this.$el.find("span").toggleClass("icon-star icon-star-empty")},updateFavorite:function(){var status=this.model.get("selected"),ENDPOINT_URL=APIEndpoint+"/me/favorites/"+this.model.get("type"),that=this;status?(ENDPOINT_URL=ENDPOINT_URL+"/remove/"+this.model.get("id"),$.ajax({type:"DELETE",url:ENDPOINT_URL,xhrFields:{withCredentials:!0},contentType:"application/json"}).success(function(response){debug("DESTROY MODEL",response),that.toggleSelected()})):(this.model.urlRoot=ENDPOINT_URL,this.model.save({},{contentType:"application/json",xhrFields:{withCredentials:!0},success:function(model,response){debug("SAVE MODEL",response),that.toggleSelected()}}))},render:function(){var that=this;this.model.get("selected")&&(this.$el.find("span").removeClass("icon-star-empty").addClass("icon-star"),this.options.updateCallback()),this.$el.on("click",function(){that.updateFavorite()})}}),DataBikes={},DataClass={},BikeClassDetail={},RegularClassDetail={},isCycling=$("nav.buttons").data("iscycling");DataBikes.init=function(ENDPOINT){$.ajax({type:"GET",url:ENDPOINT,contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",success:function(data){debug("bikesdata",data),null!==data.reservation.result?$(".see-bike").addClass("active"):($(".see-bike").removeClass("active"),$(".book-bike").addClass("active")),data.isClosed===!0&&$(".see-bike, .book-bike").removeClass("active")},error:function(d){debug("server error",d.responseJSON)}})},DataClass.init=function(CLASSENDPOINT){$.ajax({type:"GET",url:CLASSENDPOINT,contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",success:function(data){if(debug("classdata",data),data.isOnCalendar===!1)$(".add-class").addClass("active");else if("True"===isCycling){BikeClassDetail.classInstance=$("nav.buttons").data("id");var ENDPOINT=APIEndpoint+"/classes/bikes/"+BikeClassDetail.classInstance;DataBikes.init(ENDPOINT)}else $(".remove-class").addClass("active");$(".add-class").on("click",DataClass.addClass),$(".remove-class").on("click",DataClass.removeClass)},error:function(d){debug("server error",d.responseJSON)}})},DataClass.addClass=function(e){e.preventDefault();var ENDPOINT=APIEndpoint+"/me/calendar/"+$("nav.buttons").data("id")+"?isRecurring=false",$this=e.currentTarget;$.ajax({type:"POST",url:ENDPOINT,contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",success:function(data){debug("[ADDCLASS OK]",data),"True"===isCycling?($(".bike-overlay").addClass("active"),setTimeout(function(){$(".bike-overlay").removeClass("active"),$(".add-class").hide(),$(".book-bike").addClass("active")},5e3)):($($this).addClass("added").text("Added to calendar!"),setTimeout(function(){$($this).hide(),$(".remove-class").addClass("active")},5e3))},error:function(d){debug("server error",d.responseJSON)}})},DataClass.removeClass=function(e){e.preventDefault();var ENDPOINT=APIEndpoint+"/me/calendar/cancel/"+$("nav.buttons").data("id")+"?removeRecurring=false";$.ajax({type:"DELETE",url:ENDPOINT,contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",success:function(data){debug("[REMOVECLASS OK]",data),$(".add-class").show()},error:function(d){debug("server error",d.responseJSON)}})},ClassDetail.renderButtons=function(){BikeClassDetail.classInstance=$("nav.buttons").data("id"),RegularClassDetail.classInstance=BikeClassDetail.classInstance;var CLASSENDPOINT=APIEndpoint+"/classes/"+RegularClassDetail.classInstance;DataClass.init(CLASSENDPOINT)},ClassDetail.init=function(id){console.log(id),EQ.Helpers.user.getFavorites(function(favoritesData){var favoritesContainerView=new FavoritesContainerView({favoritesData:favoritesData});favoritesContainerView.render()}),ClassDetail.renderButtons()}}(window.App),function(global){"use strict";var Facilities=App.Pages.Facilities={};Facilities.Icon=function(facility){return'<div class="custom-marker active"><span class="icon-marker-o"></span><h5>'+facility.ClubName+"</h5></div>"},Facilities.setClub=function(clubId){var club=this.clubsMap.getFacilityById(clubId),Map=this.clubsMap.Map,marker=Map.markers.find(club.Latitude,club.Longitude);Map.fit([club],-3).freeze(),$(".native-map-trigger").attr("href",EQ.Helpers.getDeviceMapURL(club)),marker&&(debug("[ClubDetail] Setting marker open:",marker),marker.setAnchor(RichMarkerPosition.TOP),marker.setContent(Facilities.Icon(club)))},Facilities.init=function(region,subregion,club){debug("[ClubDetail] init:",club),global.isClubDetail=!0,2===arguments.length?(club=subregion,subregion=null):1===arguments.length&&(club=region,subregion=null,region=null),EQ.Maps.on("IDLE_LOAD",function(){Facilities.clubsMap=$(".map-container").data("clubsMap"),Facilities.setClub(currentClub)})}}(window),function(global,App){"use strict";var Clubs=App.Pages.Clubs={};Clubs.Region={showAll:function(){var that=this;Clubs.Map.markers.empty(),$.each(Clubs.Data,function(i,region){region.bounds||(region.bounds=EQ.Maps.Bounds(Clubs.getChildrenPoints(region))),that.addMarker(region)}),EQ.Maps.once("IDLE",Clubs.updateLabelPosition)},addMarker:function(region){Clubs.Map.markers.add({lat:region.bounds.getCenter().lat(),lng:region.bounds.getCenter().lng(),content:Clubs.Icon.Region(region),click:function(evt){evt.stopPropagation(),Clubs.Region.select(region)}},!0)},showClubs:function(region){debug("[Clubs] Showing clubs markers"),EQ.Maps.once("BOUNDS_CHANGE",function(data){debug("[Clubs] Setting markerThreshold:",data.map.getZoom()),Clubs.markerThreshold=data.map.getZoom()}),Clubs.Map.fitBounds(region.bounds),Clubs.Club.showAll()},showSubs:function(region){debug("[Clubs] Region level (showing Subregion labels)"),"New York"===region.Name&&region.bounds.extend(EQ.Maps.Point({lat:40.45,lng:-74.15})),Clubs.Map.fitBounds(region.bounds),Clubs.Subregion.showAll()},select:function(region){var that=this;region.bounds||(region.bounds=EQ.Maps.Bounds(Clubs.getChildrenPoints(region))),$.each(region,function(property,value){if("string"==typeof value){var $el=$('[data-region-text="'+property.toLowerCase()+'"]');$el.length&&$el.html(value)}}),Clubs.isRegionLanding||$(".region-information .description").load("/regions/"+region.ShortName+" .paragraph p"),region.SubRegions&&region.SubRegions.length?(debug("[Clubs] It has subregions"),EQ.Geo.getNearestClub(function(club){var candidate;debug("[Clubs] Nearest club is:",club),club&&club.Region===region.Title&&$.each(region.SubRegions,function(i,subregion){$.each(subregion.Facilities,function(j,facility){facility.Id===club.Id&&(candidate=subregion)})}),candidate&&!Clubs.isRegionLanding?(debug("[Clubs] Chosen subregion is:",candidate.Title),candidate.bounds=EQ.Maps.Bounds(Clubs.getChildrenPoints(candidate)),that.showClubs(candidate)):that.showSubs(region)})):that.showClubs(region)}},Clubs.Subregion={showAll:function(){var that=this;Clubs.Map.markers.empty(),$.each(Clubs.Data,function(i,region){region.bounds||(region.bounds=EQ.Maps.Bounds(Clubs.getChildrenPoints(region))),region.SubRegions&&region.SubRegions.length?$.each(region.SubRegions,function(j,subregion){subregion.bounds||(subregion.bounds=EQ.Maps.Bounds(Clubs.getChildrenPoints(subregion))),that.addMarker(subregion)}):Clubs.Region.addMarker(region)}),EQ.Maps.once("IDLE",Clubs.updateLabelPosition)},addMarker:function(subregion){Clubs.Map.markers.add({lat:subregion.bounds.getCenter().lat(),lng:subregion.bounds.getCenter().lng(),content:Clubs.Icon.Subregion(subregion),click:function(evt){evt.stopPropagation(),Clubs.Map.fitBounds(subregion.bounds),Clubs.Club.showAll()}},!0)}},Clubs.Club={parse:function(facility){return EQ.Helpers.setPositionGetter(facility),Clubs.Map.markers.add({lat:facility.Latitude,lng:facility.Longitude,content:Clubs.Icon.Marker.regular(),click:function(evt){evt.stopPropagation(),EQ.Maps.trigger("CLUB_MARKER_CLICK",{facility:facility,marker:this})}},!0),this},getLink:function(facility){return facility.URL||"/Clubs/"+facility.ShortName},show:function(data){if(Clubs.lastClubShow)return!1;if(Clubs.lastClubShow=!0,setTimeout(function(){Clubs.lastClubShow=!1},1e3),data.marker.getContent().indexOf("active")>-1)return Clubs.Club.hide();var position=data.marker.getPosition(),link=Clubs.Club.getLink(data.facility);if(Clubs.Map.map.panTo(position),Clubs.Map.markers.setIcon(Clubs.Icon.Marker.regular()),Clubs.$el.find(".icon-marker-dot").addClass("darker"),data.marker.setContent(Clubs.Icon.Marker.active(data.facility)),Clubs.$info&&(Clubs.$info.find('[data-club-href="url"]').attr("href",link),Clubs.$info.find('[data-club-text="telephone"]').attr("href","tel:"+data.facility.Telephone.replace(/\./g,"-")),$.each(data.facility,function(property,value){if("string"==typeof value){var $el=$('[data-club-text="'+property.toLowerCase()+'"]');$el.length&&$el.html(value)}})),$("div.club-information").removeClass("hidden"),"small"===EQ.Helpers.getDeviceSize()){var mapTopOffset=Clubs.$el.offset().top-$("nav.main").height();$("html, body").animate({scrollTop:mapTopOffset},300)}return this},hide:function(){"Club"===Clubs.layout&&(Clubs.Map.markers.setIcon(Clubs.Icon.Marker.regular()),Clubs.$el.find(".icon-marker-dot").removeClass("darker"))},showAll:function(){if(Clubs.layout="Club",Clubs.preventZoomChange=!0,Clubs.Map.markers.empty(),!this._facilities){var facilities=[];$.each(Clubs.Data,function(i,region){facilities=facilities.concat(EQ.Helpers.getAllFacilities(region))}),this._facilities=facilities}$.each(this._facilities,function(i,club){Clubs.Club.parse(club)})}},Clubs.Icon={Marker:{regular:function(){return'<div class="custom-marker"><span class="icon-marker-dot"></span></div>'},active:function(facility){return'<div class="custom-marker active"><span class="icon-marker-o"></span><h5>'+facility.ClubName+'</h5><div class="is-tablet is-desktop"><address>'+facility.GoogleAddress+'</address><a href="'+Clubs.Club.getLink(facility)+'" class="button white fat cta">More Info</a></div></div>'}},Subregion:function(subregion){var n=subregion.Facilities.length;return'<div class="custom-marker caption"><span>'+subregion.Name+"</span><small>"+n+" Club"+(1===n?"":"s")+"</small></div>"},Region:function(region){var n=region.Facilities.length;return $.each(region.SubRegions,function(i,subregion){n+=subregion.Facilities.length}),'<div class="custom-marker caption"><span>'+region.Name+"</span><small>"+n+" Club"+(1===n?"":"s")+"</small></div>"}},Clubs.getChildrenPoints=function(region){var that=this,points=[];return region.SubRegions&&region.SubRegions.length?$.each(region.SubRegions,function(i,subregion){points=points.concat(that.getChildrenPoints(subregion))}):region.Facilities.length&&(points=$.map(region.Facilities,function(club){return club.Latitude&&club.Longitude?EQ.Maps.Point({lat:club.Latitude,lng:club.Longitude}):void console.error("A club doesn't have Lat Lng properties.",club)})),points},Clubs.updateLabelPosition=function(){debug("[Clubs] updatePosition length:",$(".custom-marker.caption").length);var containerY,currentY,labels=[];if($(".custom-marker.caption").each(function(){var $el=$(this),offset=$el.offset();labels.push({y:offset.top,height:$el.height()>>0,x:offset.left,width:$el.width()>>0,el:$el.offsetParent()})}),labels.length){labels.sort(function(a,b){return a.y-b.y}),currentY=labels[0].y-1,containerY=labels[0].el.offsetParent().offset().top;for(var i=0,l=labels.length;l>i;i++){var label=labels[i];if(label.y>currentY)currentY=label.y+label.height;else{var prevLabel=labels[i-1];label.x>prevLabel.x+prevLabel.width?debug("[Clubs] Should not collide:",label.el,prevLabel.el):(label.el.css("top",currentY-containerY),currentY+=label.height)}}}},Clubs.hasToChangeLayout=function(zoom){var layout=null,subregionThreshold=Clubs.subregionThreshold||9,markerThreshold=Clubs.markerThreshold||13;return layout=subregionThreshold>zoom?"Region":markerThreshold>zoom?"Subregion":"Club",layout!==Clubs.layout?(Clubs.layout=layout,!0):!1},Clubs.onMapsLoaded=function(){$(".club-finder").addClass("visible"),Clubs.$el=$(".map-container");var minZoom="small"===EQ.Helpers.getDeviceSize()?7:10;if(Clubs.Map=new EQ.Maps.Map(Clubs.$el[0],41.850033,-87.6500523,{zoom:minZoom,minZoom:minZoom}),Clubs.Map.mobilePanning(),EQ.Maps.on("CLUB_MARKER_CLICK",Clubs.Club.show),EQ.Maps.on("MAP_CLICK",function(){Clubs.lastClubShow||Clubs.Club.hide()}),EQ.Maps.on("ZOOM_CHANGE",function(data){return Clubs.preventZoomChange?(Clubs.preventZoomChange=!1,!1):void(Clubs.hasToChangeLayout(data.zoom)?Clubs[Clubs.layout].showAll():"Club"===Clubs.layout?Clubs.Club.hide():Clubs.updateLabelPosition())}),Clubs.isRegionLanding){var candidate=EQ.Helpers.getRegionByTitle($(".clubs-region").data("region"));candidate&&(Clubs.preventZoomChange=!0,Clubs.Region.select(candidate))}else EQ.Geo.getNearestRegion(function(candidate){candidate&&(Clubs.preventZoomChange=!0,Clubs.Region.select(candidate))})},Clubs.Data=global.allRegionsData,Clubs.setupTabs=function(){$(".tabs-simple").simpleTabs({onTabShown:function(){setTimeout(function(){console.warn("load near clubs map"),EQ.Maps.fixLayout()},600)}})},Clubs.hideOfflineMsg=function(){Clubs.$views.$geoOffline.hide()},Clubs.setDefaultMap=function(){if(!Clubs.userLocationKnown){Clubs.$el=$(".map-container");var minZoom=3;Clubs.Map=new EQ.Maps.Map(Clubs.$el[0],41.850033,-87.6500523,{zoom:minZoom,minZoom:minZoom}),Clubs.Club.showAll()}},Clubs.setTemporaryInfo=function(){Clubs.setDefaultMap()},Clubs.bindings=function(){Clubs.$views.$geoOffline.find("a").on("click",function(e){e.preventDefault(),$(this).closest(".geo-offline").hide()})},Clubs.$views={$geoOffline:$(".geo-offline")},Clubs.userLocationKnown=!1,Clubs.init=function(region){Clubs.isRegionLanding=!!region,Clubs.$finder=$(".club-finder"),Clubs.$info=$("div.club-information"),Clubs.bindings(),Clubs.setupTabs(),EQ.Maps.on("CLUB_SET_CENTER",function(loc){Clubs.Map.map.setCenter({lat:loc.lat,lng:loc.lng}),Clubs.Map.map.minZoom=3,Clubs.Map.unfreeze(),Clubs.Map.markers={map:{},markers:[]},setTimeout(function(){Clubs.Map.map.setZoom(1)},1e3)}),EQ.Geo.getLatLng(function(){debug("[Clubs Finder] ALLOWED TO USE GEO API"),Clubs.hideOfflineMsg(),Clubs.userLocationKnown=!0,EQ.Maps.Load(Clubs.onMapsLoaded)},function(){debug("[Clubs Finder] NOT ALLOWED TO USE GEO API"),Clubs.isRegionLanding?EQ.Maps.Load(Clubs.onMapsLoaded):($(".region-information").hide(),Clubs.$finder.removeClass("module").find(".region-list-container").removeClass("module"))});var $links=$(".switch-views nav a");$links.on("click",function(){$links.removeClass("active").filter(this).addClass("active"),Clubs.$finder.toggleClass("listing")})}}(window,window.App),function(global,App){"use strict";var ConnnectAccounts=App.Pages.ConnnectAccounts={},$loginForm=$("form.login");ConnnectAccounts.validateAndSubmit=function(){$loginForm.data("publicMethods").isValid()&&$loginForm.data("publicMethods").sendAjaxRequest({username:"email",password:"password",persistLogin:!0},function(data,textStatus,jqXHR){202!==jqXHR.status&&App.Pages.ConnnectAccounts.getToken(function(token){var facebookToken={facebookAccessToken:token};$.ajax(APIEndpoint+"/registration/linkwithfacebook",{data:JSON.stringify(facebookToken),contentType:"application/json",type:"POST",xhrFields:{withCredentials:!0}}).done(function(){debug("[Connect] Ready"),global.location.href="/"}).fail(function(jqXHR){var errorText=jqXHR.responseJSON&&jqXHR.responseJSON.error&&jqXHR.responseJSON.error.message;debug("[FBLogin] Failed",errorText),errorText&&$(".is-error").removeClass("hidden").text(errorText)})})})},ConnnectAccounts.getToken=function(cb){FB.login(function(response){"connected"===response.status&&cb(response.authResponse.accessToken)},{scope:"email,user_likes"})},ConnnectAccounts.init=function(){debug("[Connect] Init"),"undefined"!=typeof global.user&&global.user&&(global.location.href="/"),$loginForm.on("submit",function(e){e.preventDefault(),ConnnectAccounts.validateAndSubmit()})}}(window,window.App),function(global,App){"use strict";var CreateAccount=App.Pages.CreateAccount={},$createAccountForm=$(".create-account");CreateAccount.init=function(){debug("[CreateAccount] Init"),CreateAccount.bind()},CreateAccount.bind=function(){var that=CreateAccount;$createAccountForm.on("submit",function(e){e.preventDefault(),that.validateAndSubmit()})},CreateAccount.validateAndSubmit=function(){$createAccountForm.data("publicMethods").isValid()&&$createAccountForm.data("publicMethods").sendAjaxRequest({email:"Create.Email",password:"Create.Password",sourceSystem:"Create.Country",lastName:"Create.LastName",firstName:"Create.FirstName",barcodeId:"Create.BarcodeId"},function(){console.log($createAccountForm.find('input[name="Create.Email"]').val());var userModel={email:$createAccountForm.find('input[name="Create.Email"]').val()};debug("[CreateAccount] Callback"),$(".user-recover-confirmation").removeClass("hidden");var $confirmationModule=$(".confirmation-message-module");$confirmationModule.data("templateData",userModel),$confirmationModule.data("publicMethods").render(),$createAccountForm.add(".tpl-subtitleparagraphcallout.dtm-user-subtitleparagraphcallout").add(".create-acount-mail-sent").addClass("hidden"),$("body, html").animate({scrollTop:0})})}}(window,window.App),function(global,App){"use strict";App.Pages.GroupFitness={};var GroupFitness=App.Pages.GroupFitness;GroupFitness.init=function(){$(window).on("resize scroll",GroupFitness.expandQuilt),GroupFitness.expandQuilt()},GroupFitness.expandQuilt=function(){var images=$('[class*="image-"]'),headerHeight=$('[data-component="navigation"]:visible').height(),winWidth=$(window).width(),winHeight=$(window).height()-headerHeight;images.on("click",function(e){e.preventDefault();var image={imgOffsetX:$(this).offset().left,imgOffsetY:$(this).offset().top,imgWidth:$(this).width(),imgHeight:$(this).height()};$('.grid-active [class*="image-"]').remove(),$(this).addClass("selected").clone().fadeIn().appendTo(".grid-active").addClass("active").css({width:image.imgWidth+"px",height:image.imgHeight+"px",top:image.imgOffsetY+"px",left:image.imgOffsetX+"px"}),$(".grid-active").fadeIn().addClass("active"),$(".groupfitness").addClass("overlay"),$(".grid-active .close").css({top:headerHeight+$(window).scrollTop()+10+"px"}),setTimeout(function(){$(".grid-active .active").css({width:winWidth+"px",height:winHeight+"px",top:headerHeight+$(window).scrollTop()+"px",left:"0"}),$('.grid-active [class*="image-"]').addClass("overlay")},100),$(".grid-active .close").on("click",function(){$(".grid-active .active").css({width:image.imgWidth+"px",height:image.imgHeight+"px",top:image.imgOffsetY+"px",left:image.imgOffsetX+"px"}),setTimeout(function(){$(".grid-active").removeClass("active").hide(),$(".grid-active .active").remove(),$(".groupfitness").removeClass("overlay")},500),$(".group-grid .selected").removeClass("selected")})})}}(window,window.App),function(global,App){"use strict";var Home=App.Pages.Home={},$body=$("body"),$win=$(global);Home.fitElement={currentTop:0,currentPage:0,hideTimeout:void 0,isSupported:function(){var width=$win.width(),height=$win.height();return 320===width&&460===height||1024===width&&672===height||1024===width&&692===height||1024===width&&691===height||768===width&&927===height||768===width&&928===height},isTouch:function(){return"undefined"!=typeof document.documentElement.ontouchstart},bind:function(){var that=this;$win.on("orientationchange",function(){that.touchSupport(that.isSupported()),that.$el.removeClass("animating"),that.$children.removeClass("active"),$(".more-button").removeClass("hidden scrolling"),Home.fitElement.isSupported()===!1?($body.removeClass("closed-nav"),$body.addClass("no-snap")):($body.addClass("closed-nav"),$body.removeClass("no-snap")),that.currentPage=0,that.setScrollTop(0),$(".elevator a").removeClass("selected"),$(".elevator a").eq(0).addClass("selected"),$(".page-wrapper").data("plugin_stellar")&&$(".page-wrapper").data("plugin_stellar").refresh(),Home.fitElement.isTouch()&&Home.fitElement.isSupported()&&void 0===$(".page-wrapper").data("plugin_stellar")&&$(".page-wrapper").stellar({horizontalScrolling:!1,scrollProperty:"transform",positionProperty:"transform",hideDistantElements:!1})}),this.$el.on("webkitTransitionEnd transitionend",function(evt){evt.target===that.$el[0]&&(that.$el.removeClass("animating"),$(".more-button").removeClass("scrolling"),Home.fitElement.hideTimeout=setTimeout(function(){$(".elevator").addClass("hide")},2e3))}),$("nav.main .full-wrapper").on("touchend",function(evt){evt.stopPropagation()}).on("touchmove",function(evt){evt.preventDefault()});for(var elevetorLength=this.$children.length-1,i=0;elevetorLength>i;i++){var $elevatorCircle=$('<a href="#" class="elevator-button" data-index="'+i+'"><span class="inner"></span></a>');$(".elevator").append($elevatorCircle)}$(".elevator a").eq(0).addClass("selected"),$(".elevator-trigger").on("click",this.elevator),$(".more-button").on("click",function(){Home.fitElement.currentPage<Home.fitElement.$children.length-2&&(Home.fitElement.currentPage++,Home.fitElement.goTo())})},init:function(selector,childrenSelector){this.$el=$(selector),this.$children=this.$el.find(childrenSelector),this.bind(),this.isSupported()&&this.touchSupport(!0)},getScrollTop:function($el){$el=$el||this.$el;var computedTransform=$el.css("transform");return"none"!==computedTransform?-1*parseInt(computedTransform.match(/(-?[0-9]+)/g)[5],10):0},setScrollTop:function(n){this.maxScrollTop=this.$el.height()-this.$children.eq(0).height(),1>n?n>=-this.maxScrollTop&&this.$el.css("transform","translate3d(0, "+n+"px, 0)"):this.$el.css("transform","translate3d(0, 0, 0)")},goNext:function(){return this.currentPage===this.$children.length-1?!1:(this.currentPage++,this.goTo(),!0)},goPrev:function(){return 0===this.currentPage?!1:(this.currentPage--,this.goTo(),!0)},goTo:function(){var $page=this.$children.eq(this.currentPage),$el=this.$el;this.currentPage?$body.removeClass("closed-nav"):$body.addClass("closed-nav"),clearTimeout(this.hideTimeout);var $elevatorLinks=$(".elevator a"),$elevatorCurrent=$(".elevator a.selected"),$elevator=$(".elevator");$elevatorCurrent.removeClass("selected"),$elevatorLinks.eq(this.currentPage).addClass("selected"),$elevator.removeClass("hide"),$page.find(".carousel").first().hasClass("black")===!0||$page.find(".rich-content").first().hasClass("black")===!0?$elevator.addClass("black"):$elevator.removeClass("black"),$(".more-button").addClass("scrolling"),$(".more-button").removeClass("hidden"),$el.addClass("animating"),this.$children.removeClass("active"),$page.addClass("active"),"Footer"!==$page.data("template")?this.setScrollTop(-$page.position().top):($elevator.addClass("hide"),this.setScrollTop(-($el.height()-this.$children.eq(0).height()))),this.currentPage>=1&&$(".more-button").addClass("hidden")},elevator:function(e){if(e.preventDefault(),Home.fitElement.isSupported()===!0)$(".elevator a").removeClass("selected"),$(".elevator a").eq($(this).data("index")).addClass("selected"),Home.fitElement.currentPage=+$(this).data("index"),Home.fitElement.goTo();else{var pos=$(".page-snap").eq($(this).data("index")).offset().top-$("nav.main").height();$("body").animate({scrollTop:pos})}}},Home.fitElement.touchSupport=function(that){var element,elementY,startY,startX,dx,dy,EVENT_START="touchstart",EVENT_MOVE="touchmove",EVENT_END="touchend",isHorizontal=!1,onTouchStart=function(evt){var touch=evt.touches[0];startY||that.$el.is(".animating")?evt.preventDefault():(startY=touch.pageY,startX=touch.pageX,elementY=that.getScrollTop(),element.addEventListener(EVENT_MOVE,onTouchMove,!1),element.addEventListener(EVENT_END,onTouchEnd,!1))},onTouchMove=function(evt){var touch=evt.touches[0];dy=touch.pageY-startY,dx=touch.pageX-startX,isHorizontal=Math.abs(dx)>Math.abs(dy),isHorizontal||(evt.preventDefault(),that.setScrollTop(dy-elementY))},onTouchEnd=function(){!isHorizontal&&Math.abs(dy)>10?0>dy?that.goNext():dy>0&&that.goPrev():that.setScrollTop(-elementY),dy=null,startY=null,isHorizontal=!1,element.removeEventListener(EVENT_MOVE,onTouchMove,!1),element.removeEventListener(EVENT_END,onTouchEnd,!1)};return function(isActive){return element=that.$el[0],isActive?(element.addEventListener(EVENT_START,onTouchStart,!1),that.currentPage?that.goTo():($body.addClass("closed-nav"),$body.scrollTop(0)),$body.addClass("page-snap-enabled"),void 0):(that.setScrollTop(0),that.currentPage=0,$body.removeClass("page-snap-enabled closed-nav"),element.removeEventListener(EVENT_START,onTouchStart,!1))}}(Home.fitElement),Home.init=function(){Home.fitElement.isSupported()===!1&&$(".home-splash").height($(window).height()-$("nav.main").height()),Home.fitElement.init(".page-wrapper",".page-snap"),Home.fitElement.isTouch()&&Home.fitElement.isSupported()&&$(".page-wrapper").stellar({horizontalScrolling:!1,scrollProperty:"transform",positionProperty:"transform",hideDistantElements:!1})}}(window,window.App),function(global,App){"use strict";var Join=App.Pages.Join={};Join.SelectClub={},Join.SelectMembership={},Join.MembershipPurchase={},Join.SelectClub.FindByZip=function(cb,err){var ENDPOINT=APIEndpoint+"/facilities",zipcode=$('input[name="SearchByZip.ZipCode"]').val();$.get(ENDPOINT,{zip:zipcode,numberFacilities:5,radius:1e3},function(d){console.log(d),cb&&"function"==typeof cb&&(0===d.facilities.length?EQ.Geo.getLatLng(function(){EQ.Geo.getNearestClub(function(club){return null===club?(err(),!1):(debug("[GetNearestClub] ",club),$(".nearme").data("clubSelector").set(club),EQ.Maps.fixLayout(),void cb(d))})}):(cb(d),$(".nearme").data("clubSelector").set(d.facilities[0])))}).fail(err)},Join.SelectClub.bind=function(){$(".search").on("submit",function(e){e.preventDefault(),$(this).data("publicMethods").isValid()&&($('input[type="submit"]').data("original-text",$('input[type="submit"]').val()).val("Loading...").attr("disabled",!0),Join.SelectClub.FindByZip(function(){$("form").addClass("is-hidden"),$(".nearme-wrapper").removeClass("is-hidden"),$(".tpl-ctacallout a").css("display","block"),EQ.Maps.fixLayout()},function(){$('input[type="submit"]').val($('input[type="submit"]').data("original-text")).attr("disabled",!1),$("form").find(".is-error").removeClass("hidden").text("Zip code not found")}),$('.nearme select[name="facilities"]').on("change",function(){var ShortName=$(".nearme").data("clubSelector").get().ShortName;$(".tpl-ctacallout a").attr("href","/join/"+ShortName)}))})},Join.SelectClub.init=function(){Join.SelectClub.bind()},Join.SelectMembership.bind=function(){console.log("Step2 Init!"),$("a.join-now").on("click",function(e){e.preventDefault(),$(this).next("form").submit()})},Join.SelectMembership.init=function(){Join.SelectMembership.bind()},Join.MembershipPurchase.Submit=function(){var ENDPOINT=APIEndpoint+"/registration/residential";
$(".personal-information .submit").attr("disabled",!0),$(".personal-information .submit").val("Purchasing...");var $personalInformation=$(".personal-info"),$billingInformation=$(".billing-info"),$country=$personalInformation.find('input[name="Plan.CountryName"]').val(),PersonalData={firstName:$personalInformation.find('input[name="MemberInformation.FirstName"]').val(),lastName:$personalInformation.find('input[name="MemberInformation.LastName"]').val(),emailAddress:$personalInformation.find('input[name="MemberInformation.EmailAddress"]').val(),phoneNumber:$personalInformation.find('input[name="MemberInformation.PhoneNumber"]').val(),address:{street:$personalInformation.find('input[name="MemberInformation.Address1"]').val(),"street-additional":$personalInformation.find('input[name="MemberInformation.Address2"]').val(),city:$personalInformation.find('input[name="MemberInformation.City"]').val(),state:"UK"!==$country&&"CA"!==$country?$personalInformation.find('select[name="MemberInformation.State"]').val():"",province:"",zip:$personalInformation.find('input[name="MemberInformation.ZipCode"]').val(),country:$country,stateProvince:"US"!==$country&&"CA"!==$country?$personalInformation.find('input[name="MemberInformation.State"]').val():$personalInformation.find('select[name="MemberInformation.State"]').val()}},BillingData={firstName:$billingInformation.find('input[name="BillingInformation.FirstName"]').val(),lastName:$billingInformation.find('input[name="BillingInformation.LastName"]').val(),emailAddress:$billingInformation.find('input[name="BillingInformation.EmailAddress"]').val(),phoneNumber:$billingInformation.find('input[name="BillingInformation.PhoneNumber"]').val(),address:{street:$billingInformation.find('input[name="BillingInformation.Address1"]').val(),"street-additional":$billingInformation.find('input[name="BillingInformation.Address2"]').val(),city:$billingInformation.find('input[name="BillingInformation.City"]').val(),state:"UK"!==$country&&"CA"!==$country?$billingInformation.find('select[name="BillingInformation.State"]').val():"",province:"",zip:$billingInformation.find('input[name="BillingInformation.ZipCode"]').val(),country:$country,stateProvince:"US"!==$country&&"CA"!==$country?$billingInformation.find('input[name="BillingInformation.State"]').val():$billingInformation.find('select[name="BillingInformation.State"]').val()}},PostData={facilityId:$personalInformation.find('input[name="Plan.FacilityId"]').val(),membershipPlanId:$personalInformation.find('input[name="Plan.PlanId"]').val(),countryId:$personalInformation.find('input[name="sourceSystem"]').val(),member:PersonalData,billing:BillingData,creditCard:{cardNumber:$billingInformation.find('input[name="BillingInformation.CreditCardNumber"]').val(),expirationMonth:$billingInformation.find('select[name="BillingInformation.ExpirationMonth"]').val(),expirationYear:$billingInformation.find('select[name="BillingInformation.ExpirationYear"]').val(),cvc:$billingInformation.find('input[name="BillingInformation.CreditCardSecurityCode"]').val()}};$('input[name="usepersonal"]').is(":checked")&&(PostData.billing=PostData.member);var purchaseError=function(err){var $submit=$('.tpl-submitcallout input[type="submit"]');$submit.attr("disabled",!1),$submit.val($submit.data("oldCopy")),$(".is-error").removeClass("hidden").text(err),$("body, html").animate({scrollTop:$(".is-error").offset().top-100})};$.ajax({type:"POST",url:ENDPOINT,contentType:"application/json",data:JSON.stringify(PostData),dataType:"json",success:function(data){data.error?purchaseError(data.error.message):(window.tagData=window.tagData||{},window.tagData.registration={success:"true",type:"fb"},window.track("registration",window.tagData.registration),Join.MembershipPurchase.ThankYou(data))},error:function(d){purchaseError(d.responseJSON.error.message)}})},Join.MembershipPurchase.ThankYou=function(d){if(!d.error){var $personalInformation=$(".personal-info"),$form=$("<form />");$form.attr("action","/join/thank-you").attr("method","POST");var name=$personalInformation.find('input[name="MemberInformation.FirstName"]').val(),charge=$("div.total-due span.price strong").html(),$name=$('<input type="hidden"/>').attr("name","Name").val(name.charAt(0).toUpperCase()+name.slice(1)),$charge=$('<input type="hidden"/>').attr("name","Charge").val(charge),$type=$('<input type="hidden"/>').attr("name","Card.Type").val(d.cardType),$number=$('<input type="hidden"/>').attr("name","Card.Number").val(d.lastFour),$barcode=$('<input type="hidden"/>').attr("name","Barcode").val(d.barcodeKey);$form.append($name),$form.append($charge),$form.append($type),$form.append($number),$form.append($barcode),$("body").append($form),$form.submit()}},Join.MembershipPurchase.bind=function(){$('input[name="usepersonal"]').on("change",function(){var disabledValue=$(".billing-info .information input").attr("disabled");$(".billing-info .information").toggle(),$(".billing-info .information input").attr("disabled",!disabledValue),$(".billing-info .information select").attr("disabled",!disabledValue)}),$('.tpl-submitcallout input[type="submit"]').on("click",function(){var $submit=$('.tpl-submitcallout input[type="submit"]');$("form.personal-information").data("publicMethods").isValid()&&($submit.attr("disabled",!0),$submit.data("oldCopy",$submit.val()),$submit.val("Loading..."),$("form.personal-information").submit())}),$("form.personal-information").on("submit",function(e){e.preventDefault(),Join.MembershipPurchase.Submit()})},Join.MembershipPurchase.init=function(){Join.MembershipPurchase.bind()}}(window,window.App),function(global,App){"use strict";var Login=App.Pages.Login={},$loginForm=$("form.login");Login.validateAndSubmit=function(){$loginForm.data("publicMethods").isValid()&&$loginForm.data("publicMethods").sendAjaxRequest({username:"email",password:"password",persistLogin:!0},function(data,textStatus,jqXHR){if(202===jqXHR.status){if(0===data.code)return void Login.ChangeLegacyUserName(data);if(1===data.code)return void Login.RedirectToSpaPage(data)}global.location.href=decodeURIComponent(EQ.Helpers.getQueryStringVariable("ReturnUrl")||"/")})},Login.ChangeLegacyUserName=function(data){var $form=$("<form />");$form.attr("action","/help/change/username").attr("method","POST");var $email=$('<input type="hidden"/>').attr("name","email").val(data.email),$userId=$('<input type="hidden"/>').attr("name","userId").val(data.userId),$userName=$('<input type="hidden"/>').attr("name","userName").val(data.email);$form.append($email),$form.append($userId),$form.append($userName),$("body").append($form),$form.submit()},Login.RedirectToSpaPage=function(data){var $form=$("<form />");$form.attr("action","/help/upgrade/spa-member").attr("method","POST");var $firstName=$('<input type="hidden"/>').attr("name","firstName").val(data.firstName),$userId=$('<input type="hidden"/>').attr("name","userId").val(data.userId),$lastName=$('<input type="hidden"/>').attr("name","lastName").val(data.lastName);$form.append($firstName),$form.append($userId),$form.append($lastName),$("body").append($form),$form.submit()},Login.Facebook={bind:function(){$(".login-email").on("click",Login.Facebook.intent.bind(Login.Facebook))},intent:function(){this.getToken(function(response){window.tagData=window.tagData||{},window.tagData.regLoginWithFB={clicked:"true"},window.track("regLoginWithFB",window.tagData.regLoginWithFB),debug("FBT:",response.accessToken),$.ajax(APIEndpoint+"/authentication/fblogin",{data:{accessToken:response.accessToken},type:"POST",xhrFields:{withCredentials:!0}}).done(function(){window.track("regConnectedWithFB",{}),global.location.href=decodeURIComponent(EQ.Helpers.getQueryStringVariable("ReturnUrl")||"/")}).fail(function(){console.log("fb failed");var $form=$("<form></form>");$form.attr("action","/login/connect").attr("method","POST"),FB.api("/me",function(profileResponse){var $email=$('<input type="hidden"/>').attr("name","Email").val(profileResponse.email),$firstName=$('<input type="hidden"/>').attr("name","FirstName").val(profileResponse.first_name),$lastName=$('<input type="hidden"/>').attr("name","LastName").val(profileResponse.last_name),$fbId=$('<input type="hidden"/>').attr("name","FbId").val(response.userId),$token=$('<input type="hidden"/>').attr("name","Token").val(response.accessToken);$form.append($email),$form.append($firstName),$form.append($lastName),$form.append($fbId),$form.append($token),$form.submit()})})})},getToken:function(cb){FB.login(function(response){"connected"===response.status&&cb(response.authResponse)},{scope:"email,user_likes"})}},Login.init=function(){debug("[Login] Init"),"undefined"!=typeof global.user&&global.user&&(global.location.href="/"),$loginForm.on("submit",function(e){e.preventDefault(),Login.validateAndSubmit()}),App.Events.on("fbsdk:loaded",function(){Login.Facebook.bind()})}}(window,window.App),function(global,App){"use strict";var Mock=App.Pages.Mock={},_=global._;Mock.Book={},Mock.Book.init=function(){debug("[Mock.Book] Init"),Mock.Book.bind()},Mock.Book.bind=function(){$(".bike-filters > li > a").on("click",function(){$(this).addClass("active"),$(this).find("input").focus()}),$(".bike-filters ul li a").on("click",function(){$(this).toggleClass("active")}),$(".remove-filter").on("click",function(e){e.stopPropagation(),$(this).prev().val(""),$(".bike-filters li a.active").removeClass("active")}),$(".bike-filters .checkbox").on("change",function(){var label=$(this).find(".label").text(),icon=$(this).closest("ul[data-icon]").attr("data-icon"),$filter=$('<li data-filter="'+label+'" class="'+icon+'"><span>'+label+"</span></li>");$(this).hasClass("checked")?$filter.appendTo(".added-filters"):$('.added-filters li[data-filter="'+label+'"]').remove()})},Mock.Book.drawMap=function(){var mapHeight,$map=$(".bikes-graphic"),mapWidth=$map.width(),jsonData=Mock.Book.jsonMap,mapProportion=jsonData.layout.width/mapWidth,bikes=jsonData.layout.bikes,doors=jsonData.layout.doors;mapHeight=Math.floor(mapWidth*jsonData.layout.heigth/jsonData.layout.width),_.each(bikes,function(bike){Mock.Book.drawBike(bike,mapProportion)}),_.each(doors,function(door){Mock.Book.drawDoor(door,mapProportion)})},Mock.Book.drawBike=function(bike,mapProportion){var $map=$(".bikes-graphic"),$bike=$('<div class="bike">'+bike.localId+"</div>"),bikeLeft=Math.floor(bike.studioGridX/mapProportion),bikeTop=Math.floor(bike.studioGridY/mapProportion);$map.append($bike),$bike.css({top:bikeTop+"px",left:bikeLeft+"px"}),bike.isDisabled===!0&&$bike.addClass("unavailable"),bike.reserved===!0&&$bike.addClass("selected")},Mock.Book.drawDoor=function(door,mapProportion){var $map=$(".bikes-graphic"),$door=$('<div class="door icon-door"></div>'),doorLeft=Math.floor(door.studioGridX/mapProportion),doorTop=Math.floor(door.studioGridY/mapProportion);$map.append($door),$door.css({top:doorTop+"px",left:doorLeft+"px"})},Mock.Book.jsonMap={reservation:{result:null},layout:{clubId:113,clubName:"50th St. @ Broadway",heigth:475,width:925,id:104,name:"Cycling Studio",bikes:[{clubId:113,studioId:104,studioGridY:145,studioGridX:320,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:1415,isDisabled:!1,localId:1,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:90,studioGridX:320,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:1416,isDisabled:!1,localId:2,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:35,studioGridX:320,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:1417,isDisabled:!1,localId:3,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:145,studioGridX:420,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:1418,isDisabled:!1,localId:4,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:90,studioGridX:420,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:1419,isDisabled:!1,localId:5,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:35,studioGridX:420,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:1420,isDisabled:!1,localId:6,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:145,studioGridX:515,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:1421,isDisabled:!1,localId:7,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:90,studioGridX:515,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2747,isDisabled:!1,localId:8,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:35,studioGridX:515,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2839,isDisabled:!1,localId:9,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:140,studioGridX:690,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2840,isDisabled:!1,localId:10,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:195,studioGridX:690,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2841,isDisabled:!1,localId:11,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:250,studioGridX:690,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2842,isDisabled:!1,localId:12,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:305,studioGridX:690,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2843,isDisabled:!1,localId:13,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:360,studioGridX:690,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2844,isDisabled:!1,localId:14,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:415,studioGridX:690,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2845,isDisabled:!1,localId:15,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:195,studioGridX:605,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2846,isDisabled:!1,localId:16,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:250,studioGridX:605,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2847,isDisabled:!1,localId:17,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:305,studioGridX:605,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2848,isDisabled:!1,localId:18,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:360,studioGridX:605,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2849,isDisabled:!1,localId:19,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:415,studioGridX:605,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2850,isDisabled:!1,localId:20,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:410,studioGridX:480,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2851,isDisabled:!1,localId:21,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:410,studioGridX:415,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2852,isDisabled:!1,localId:22,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:410,studioGridX:350,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2853,isDisabled:!1,localId:23,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:410,studioGridX:290,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2854,isDisabled:!1,localId:24,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:410,studioGridX:230,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2855,isDisabled:!1,localId:25,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:410,studioGridX:165,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2856,isDisabled:!1,localId:26,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:410,studioGridX:55,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2857,isDisabled:!1,localId:27,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:300,studioGridX:445,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:2858,isDisabled:!1,localId:28,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:300,studioGridX:330,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:3160,isDisabled:!1,localId:29,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:300,studioGridX:260,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:3612,isDisabled:!1,localId:30,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:300,studioGridX:190,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:3613,isDisabled:!1,localId:31,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:300,studioGridX:120,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:3614,isDisabled:!1,localId:32,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1},{clubId:113,studioId:104,studioGridY:300,studioGridX:55,gridItemTypeId:1,gridItemType:"Bike",gridItemImage:"bike.jpg",reservableEquipId:3615,isDisabled:!1,localId:33,equipmentName:"Bike",reserved:!1,reservedByUserSecId:null,equipmentId:1}],doors:[{clubId:113,studioId:104,studioGridY:35,studioGridX:695,gridItemTypeId:5,gridItemType:"Door - Bottom Left",gridItemImage:"doorBL.gif",reservableEquipId:null,isDisabled:null,localId:null,equipmentName:null,reserved:!1,reservedByUserSecId:null,equipmentId:null},{clubId:113,studioId:104,studioGridY:85,studioGridX:695,gridItemTypeId:5,gridItemType:"Door - Bottom Left",gridItemImage:"doorBL.gif",reservableEquipId:null,isDisabled:null,localId:null,equipmentName:null,reserved:!1,reservedByUserSecId:null,equipmentId:null}],instructors:[{clubId:113,studioId:104,studioGridY:55,studioGridX:100,gridItemTypeId:2,gridItemType:"Instructor",gridItemImage:"instructor.gif",reservableEquipId:null,isDisabled:null,localId:null,equipmentName:null,reserved:!1,reservedByUserSecId:null,equipmentId:null}]},strikes:{count:0,expiresOn:"2014-02-22T06:05:34.9173881-05:00"}}}(window,window.App),function(global,App){"use strict";App.Pages.Notifications={};var Notifications=App.Pages.Notifications,Notification=Backbone.Model.extend({defaults:{description:"",time:moment().format("h:hh A"),type:0}}),NotificationsCollection=Backbone.Collection.extend({model:Notification}),NotificationsListView=Backbone.View.extend({render:function(){var notificationsGroupView,notificationCount=$(".notifications-container h2 .count",this.$el),notificationsList=$(".notifications",this.$el);return notificationsGroupView=new NotificationsGroupView({collection:this.collection}),notificationsList.prepend(notificationsGroupView.render().el),notificationCount.text(this.collection.length),this}}),NotificationsGroupView=Backbone.View.extend({className:"notification-group",template:_.template($("#notificationsGroupView").html()),render:function(){var that=this;return this.$el.html(this.template({date:"today"})),this.collection.each(function(notification){var notificationItem=new NotificationSingleView({model:notification});that.$el.find(".notification-list").append(notificationItem.render().el)}),this}}),NotificationSingleView=Backbone.View.extend({tagName:"li",className:"notification",template:_.template($("#notificationSingleView").html()),render:function(){var type=this.model.get("type"),colorClass=1===type?"red":"yellow",time=moment(this.model.get("date")).format("h:hh A");return this.model.set("time",time),this.$el.addClass(colorClass),this.$el.html(this.template(this.model.toJSON())),this}});Notifications.init=function(){var notificationsPage=$(".notifications-page"),endDate=moment().subtract("days",2);$.ajax({type:"GET",url:APIEndpoint+"/me/notifications?until="+endDate.format("YYYY-MM-DD"),contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",success:function(notifications){var notificationCollection,notificationListView;debug("[NOTIFICATIONS SERVICE OK]",notifications),$.each(notifications,function(index,notification){moment().isSame(moment(notification.date).format("YYYY-MM-DD"))&&console.log(index),console.log(moment()),console.log(notification.date)}),notificationCollection=new NotificationsCollection(notifications),notificationListView=new NotificationsListView({collection:notificationCollection,el:notificationsPage}),notificationListView.render()},error:function(d){debug("server error",d.responseJSON)}})}}(window,window.App),function(global,App){"use strict";var OnBoarding=App.Pages.OnBoarding={},$container=$(".page");OnBoarding.Q2={bind:function(){debug("[onboarding] binding Q2 events")},init:function(){OnBoarding.Q2.bind()}},OnBoarding.init=function(step){debug("[OnBoarding] Init at step",step),$container.addClass("full-bleed onboarding"),OnBoarding.Q2.init(),"2"===step&&OnBoarding.Q2.init()}}(window,window.App),function(global,App){"use strict";var Password=App.Pages.Password={},$forgotPasswordForm=$(".recover-password"),$resetPasswordForm=$(".reset-password");Password.Forgot={},Password.Reset={},Password.Forgot.init=function(){debug("[forgotPassword] Init"),Password.Forgot.bind()},Password.Forgot.bind=function(){var that=Password.Forgot;$forgotPasswordForm.on("submit",function(e){e.preventDefault(),that.validateAndSubmit()})},Password.Forgot.validateAndSubmit=function(){$forgotPasswordForm.data("publicMethods").isValid()&&$forgotPasswordForm.data("publicMethods").sendAjaxRequest({email:"RecoverPassword.UserName"},function(){var $confirmationBox=$(".password-recover-confirmation"),mail=$forgotPasswordForm.data("publicMethods").getData()["RecoverPassword.UserName"];$confirmationBox.removeClass("hidden"),$confirmationBox.find(".user-email").text(mail),$forgotPasswordForm.add(".lost-credentials").add(".tpl-subtitleparagraphcallout.dtm-password-subtitleparagraphcallout").addClass("hidden"),$("body, html").animate({scrollTop:0})})},Password.Reset.init=function(){debug("[resetPassword] Init"),Password.Reset.bind()},Password.Reset.bind=function(){var that=Password.Reset;$resetPasswordForm.on("submit",function(e){e.preventDefault(),that.validateAndSubmit()})},Password.Reset.validateAndSubmit=function(){$resetPasswordForm.data("publicMethods").isValid()&&$resetPasswordForm.data("publicMethods").sendAjaxRequest({url:"ResetPassword.url",lastName:"ResetPassword.LastName",password:"ResetPassword.NewPassword"},function(){global.location.href="/"})}}(window,window.App),function(global,App){"use strict";var SignIn=App.Pages.SignIn={},$userInformation=$(".tpl-memberimagetextcallout div").data("template-data"),$eqxSignInButton=$(".eq-sign-in");SignIn.init=function(){debug("[SignIn] Init"),console.log($userInformation),SignIn.bind()},SignIn.bind=function(){var that=SignIn;this.fbLogin.bind(),$eqxSignInButton.on("click",function(e){e.preventDefault(),that.submit()})},SignIn.fbLogin={bind:function(){$(".fb-login").on("click",SignIn.fbLogin.intent.bind(SignIn.fbLogin))},intent:function(){this.getToken(function(token){debug("FBT:",token);var userInfo={barcodeId:$userInformation.BarcodeId,fbAccessToken:token,sourceSystem:$userInformation.SourceSystem,lastName:$userInformation.LastName,email:$userInformation.EmailAddress};$.ajax(APIEndpoint+"/registration/signupwithfacebook",{data:JSON.stringify(userInfo),contentType:"application/json",type:"POST",xhrFields:{withCredentials:!0}}).done(function(){debug("[FB SignUP] Success"),$.ajax(APIEndpoint+"/authentication/fblogin",{data:{accessToken:userInfo.fbAccessToken},type:"POST",xhrFields:{withCredentials:!0}}).done(function(){debug("[FBLogin] Success"),global.location.href="/"}).fail(function(jqXHR){var errorText=jqXHR.responseJSON&&jqXHR.responseJSON.error&&jqXHR.responseJSON.error.message;debug("[FBLogin] Failed",errorText),errorText&&$(".is-error").removeClass("hidden").text(errorText)})}).fail(function(jqXHR){var errorText=jqXHR.responseJSON&&jqXHR.responseJSON.error&&jqXHR.responseJSON.error.message;debug("[FBLogin] Failed",errorText),errorText&&$(".is-error").removeClass("hidden").text(errorText)})})},getToken:function(cb){FB.login(function(response){"connected"===response.status&&cb(response.authResponse.accessToken)},{scope:"email,user_likes"})}},SignIn.submit=function(){var $form=$("<form></form>");$form.attr("action","/activate/signin/equinox").attr("method","POST");var $country=$('<input type="hidden"/>').attr("name","LastName").val($userInformation.LastName),$lastName=$('<input type="hidden"/>').attr("name","Country").val($userInformation.SourceSystem),$barcode=$('<input type="hidden"/>').attr("name","Barcode").val($userInformation.BarcodeId);$form.append($country),$form.append($lastName),$form.append($barcode),$form.submit()}}(window,window.App),function(global,App){"use strict";var User=App.Pages.User={},$forgotUserForm=$(".recover-username"),$changeusernameForm=$(".change-username"),$verifyUserNameForm=$(".verify-username"),$spaMemberUpgrade=$(".spa-member-upgrade");User.Forgot={},User.ChangeUserName={},User.VerifyUserName={},User.SpaMemberUpgrade={},User.Forgot.init=function(){debug("[forgotUser] Init"),User.Forgot.bind()},User.Forgot.bind=function(){var that=User.Forgot;$forgotUserForm.on("submit",function(e){e.preventDefault(),that.validateAndSubmit()})},User.Forgot.validateAndSubmit=function(){$forgotUserForm.data("publicMethods").isValid()&&$forgotUserForm.data("publicMethods").sendAjaxRequest({country:"country",barcode:"RecoverUserName.Barcode",lastName:"RecoverUserName.LastName"},function(data){debug("[forgotUser] Callback"),$(".user-recover-confirmation").removeClass("hidden"),$(".confirmation-message-module").data("templateData",{firstName:data.firstName,email:data.email}).data("publicMethods").render(),$forgotUserForm.add(".tpl-subtitleparagraphcallout.dtm-user-subtitleparagraphcallout").add(".lost-credentials").addClass("hidden"),$("body, html").animate({scrollTop:0})})},User.ChangeUserName.init=function(){debug("[changeUserName] Init"),User.ChangeUserName.bind()},User.ChangeUserName.bind=function(){var that=User.ChangeUserName;$changeusernameForm.on("submit",function(e){e.preventDefault(),that.validateAndSubmit()})},User.ChangeUserName.validateAndSubmit=function(){$changeusernameForm.data("publicMethods").isValid()&&$changeusernameForm.data("publicMethods").sendAjaxRequest({email:"LoginWithEmailForm.EmailLabel",userId:"UserId"},function(){var $confirmationBox=$(".change-username-confirmation"),mail=$changeusernameForm.data("publicMethods").getData()["LoginWithEmailForm.EmailLabel"];$confirmationBox.removeClass("hidden"),$confirmationBox.find(".user-email").text(mail),$changeusernameForm.add(".tpl-subtitleparagraphcallout.dtm-password-subtitleparagraphcallout").addClass("hidden"),$("body, html").animate({scrollTop:0})})},User.VerifyUserName.init=function(){debug("[verifyUserName] Init"),User.VerifyUserName.bind()},User.VerifyUserName.bind=function(){var that=User.VerifyUserName;$verifyUserNameForm.on("submit",function(e){e.preventDefault(),that.validateAndSubmit()})},User.VerifyUserName.validateAndSubmit=function(){$verifyUserNameForm.data("publicMethods").isValid()&&$verifyUserNameForm.data("publicMethods").sendAjaxRequest({url:"SumbitEmailModel.Token",password:"SumbitEmailModel.Password"},function(){global.location.href=decodeURIComponent(EQ.Helpers.getQueryStringVariable("ReturnUrl")||"/")})},User.SpaMemberUpgrade.init=function(){debug("[SpaMemberUpgrade] Init"),User.SpaMemberUpgrade.bind()},User.SpaMemberUpgrade.bind=function(){var that=User.SpaMemberUpgrade;$spaMemberUpgrade.on("submit",function(e){e.preventDefault(),that.validateAndSubmit()})},User.SpaMemberUpgrade.validateAndSubmit=function(){$spaMemberUpgrade.data("publicMethods").isValid()&&$spaMemberUpgrade.data("publicMethods").sendAjaxRequest({userId:"userId",country:"country",barcode:"SpaForm.BarcodeLabel",lastName:"SpaForm.LastNameLabel"},function(){global.location.href=decodeURIComponent(EQ.Helpers.getQueryStringVariable("ReturnUrl")||"/")})}}(window,window.App),function(App){"use strict";var createComponent=function(component,$el,options){return App.Components[component]($el,options)};App.renderComponents=function(selector){var $selector=$(selector),components=[],requireComponents=[];$selector.find("[data-component]").each(function(i,el){var $el=$(el),component=$el.data("component"),options=$el.data("component-options");try{debug("[DataComponent] Loading: "+component+" component.");var C={filename:"/assets/js/app/components/min/"+component+".js",$el:$el,component:component,options:options};components.push(C),requireComponents.push(C.filename)}catch(e){console.error("data-component not found: "+component,e.stack)}});try{require(requireComponents,function(){_.forEach(components,function(c){createComponent(c.component,c.$el,c.options||{})})})}catch(e){console.error("data-component not found",e.stack)}},App.loadComponent=function(component,$el,options){debug("[DataComponent] Loading: "+component+" component."),require(["/assets/js/app/components/min/"+component+".js"],function(){createComponent(component,$el,options||{})})},App.renderComponents("body"),_.extend(Backbone.View.prototype,Backbone.Events,{renderComponents:function($el){return App.renderComponents($el),this}})}(window.App),window.App.Events.trigger("loaded"),function(global){"use strict";$(function(){$(".goto-fullsite").on("click",function(evt){global.location.search&&(evt.preventDefault(),global.location.href=global.location.href.split("#")[0]+"&"+this.href.split("?")[1])}),"android"===EQ.Helpers.getDevicePlatform()&&$("input[maxlength]").each(function(){var $input=$(this),max=$input.attr("maxlength");$input.removeAttr("maxlength"),$input.on("keydown",function(evt){var ignore=[8,9,13,33,34,35,36,37,38,39,40,46],isExtraKey=evt.altKey||evt.ctrlKey;return-1!==$.inArray(evt.keyCode,ignore)||isExtraKey?void 0:$input.val().length<max}),$input.on("keyup",function(){var value=$input.val();value.length>max&&$input.val(value.substr(0,max))})}),"#flushGeoCache"===window.location.hash&&(EQ.Geo.flushCache(),console.log("[GLOBAL] Flushing Geo Cache")),EQ.Helpers.fixRegionProperty()})}(window);
//# sourceMappingURL=app.min.js.map
/*! mindoro v0.7.0 - 2014-04-29 01:04:32 */
